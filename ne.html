<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠ - Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ© Ø§Ù„Ù†Ø¸ÙŠÙØ©</title>
    <style>
        :root {
            --header-bg: #e1e8ed;
            --border-color: #000;
            --section-head: #2c3e50;
            --beige: #f5f5dc;
            --app-bg: #f4f4f9;
        }

        * { box-sizing: border-box; }

        body {
            background: var(--app-bg);
            margin: 0; padding: 0;
            padding-top: 60px;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            font-weight: 700; 
            font-size: 14px;
        }

        /* === Ø´Ø±ÙŠØ· Ø§Ù„Ø£Ø¯ÙˆØ§Øª (ØªÙ… ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø³Ø§ÙØ§Øª Ù„Ø­Ù„ Ù…Ø´ÙƒÙ„Ø© Ø§Ø®ØªÙØ§Ø¡ Ø§Ù„Ø²Ø±) === */
        .toolbar {
            position: fixed; top: 0; left: 0; right: 0; height: 55px;
            background: #2c3e50; display: flex; justify-content: center; align-items: center; 
            gap: 5px; /* ØªÙ… Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ù…Ù† 15px Ø¥Ù„Ù‰ 5px Ù„ØªÙˆÙÙŠØ± Ø§Ù„Ù…Ø³Ø§Ø­Ø© */
            z-index: 9999; box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        .btn { 
            padding: 8px 10px; /* ØªÙ… Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ù…Ù† 15px Ø¥Ù„Ù‰ 10px Ù„Ø¶Ù…Ø§Ù† Ø§Ø­ØªÙˆØ§Ø¡ Ø§Ù„Ø£Ø²Ø±Ø§Ø± */
            border: none; border-radius: 4px; color: #fff; 
            font-weight: bold; cursor: pointer; font-size: 12px; display: flex; align-items: center; gap: 5px;
        }
        .btn-print { background: #27ae60; }
        .btn-share { background: #2980b9; }
        .btn-reset { background: #c0392b; }

        /* === Ø§Ù„ÙˆØ±Ù‚Ø© === */
        .paper {
            background: #fff;
            width: 100%; max-width: 100%;
            margin: 0 auto;
            padding: 10px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            display: flex; flex-direction: column;
        }

        /* Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù‡ÙŠÙƒÙ„ÙŠ Ø§Ù„Ø´ÙØ§Ù */
        .layout-table { 
            width: 100%; border-collapse: collapse; border: none !important; margin: 0; padding: 0;
        }
        .layout-table > thead > tr > th,
        .layout-table > tbody > tr > td {
            border: none !important; padding: 0 !important; margin: 0 !important;
        }

        /* === Ø§Ù„Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„ØµØ§Ø±Ù…Ø© Ù„Ù„Ø£Ø±Ù‚Ø§Ù… ÙˆØ§Ù„Ø®Ø·ÙˆØ· === */
        input, select { font-family: 'Arial', sans-serif; font-weight: 700; }
        
        input[type="number"], 
        input[type="tel"], 
        input[type="date"], 
        .num-font, 
        .t-input, 
        .ro, 
        #autoDate {
            font-family: 'Arial', sans-serif !important;
            direction: ltr !important;
            unicode-bidi: bidi-override !important;
            text-align: center !important;
        }

        /* === Ø§Ù„Ø­Ù„ Ø§Ù„Ø¬Ø°Ø±ÙŠ Ù„Ø¥Ø®ÙØ§Ø¡ Ù…Ø¤Ø´Ø± Ø§Ù„ØªÙ‚ÙˆÙŠÙ… (Date Picker Killer) === */
        input[type="date"] {
            -webkit-appearance: none;
            -moz-appearance: textfield;
            appearance: none;
            position: relative;
        }
        input[type="date"]::-webkit-calendar-picker-indicator {
            background: transparent;
            bottom: 0;
            color: transparent;
            cursor: pointer;
            height: auto;
            left: 0;
            position: absolute;
            right: 0;
            top: 0;
            width: auto;
            z-index: 1; /* ÙŠØ¬Ø¹Ù„ Ø§Ù„Ø­Ù‚Ù„ Ù‚Ø§Ø¨Ù„Ø§Ù‹ Ù„Ù„Ù†Ù‚Ø± ÙˆÙ„ÙƒÙ† Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø© Ù…Ø®ÙÙŠØ© */
        }
        /* Ø¥Ø®ÙØ§Ø¡ Ø¥Ø¶Ø§ÙÙŠ Ù„Ø¨Ø¹Ø¶ Ø§Ù„Ù…ØªØµÙØ­Ø§Øª */
        input[type="date"]::-webkit-inner-spin-button,
        input[type="date"]::-webkit-clear-button {
            display: none;
        }

        /* ================== Ø§Ù„ØªØ±ÙˆÙŠØ³Ø© ================== */
        .header-container {
            display: flex; justify-content: space-between; align-items: center;
            border-bottom: 3px double #000; padding-bottom: 5px; margin-bottom: 10px;
            width: 100%;
        }
        .header-right { text-align: right; width: 35%; line-height: 1.5; font-size: 11px; font-weight: 800; }
        .header-center { text-align: center; width: 30%; display: flex; flex-direction: column; align-items: center; }
        .yemen-logo { width: 70px; margin-bottom: 2px; }
        .basmala { font-family: 'Amiri', serif; font-size: 14px; margin-bottom: 2px; font-weight: bold; }
        .main-title { background: var(--beige); border: 2px solid #000; padding: 3px 20px; border-radius: 8px; font-weight: 900; font-size: 14px; }
        .header-left { width: 35%; text-align: left; font-weight: 800; font-size: 11px; display: flex; flex-direction: column; align-items: flex-end; }
        .hl-box { display: flex; flex-direction: column; align-items: flex-end; width: fit-content; }
        .hl-row { display: flex; align-items: center; gap: 5px; margin-bottom: 2px; width: 100%; justify-content: flex-end; }
        .hl-title { text-align: center; width: 100%; margin-bottom: 3px; font-size: 13px; text-decoration: underline; }
        .hl-inp { border: none; border-bottom: 1px dotted #000; text-align: center; font-weight: 800; width: 110px; background: transparent; font-size: 12px; }

        /* ================== Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ ================== */
        .scroll-box { overflow-x: auto; width: 100%; border-bottom: 1px solid #ccc; margin-bottom: 5px; }
        
        .data-table { width: 100%; border-collapse: collapse; margin-bottom: 5px; min-width: 600px; border: 1px solid #000; }
        .data-table th, .data-table td { border: 1px solid #000; padding: 1px; text-align: center; vertical-align: middle; height: 24px; }
        .data-table th { background: var(--header-bg); font-weight: 800; color: #000; font-size: 10px; }
        .data-table td input, .data-table td select { width: 100%; height: 100%; border: none; text-align: center; background: transparent; font-family: 'Arial', sans-serif; font-size: 12px; font-weight: 700; padding: 0; }
        
        .sticky { position: sticky; right: 0; background: #f4f4f4; z-index: 10; border-left: 2px solid #000; width: 85px; min-width: 85px; font-size: 10px; font-weight: 800; }
        .head-bar { background: var(--section-head); color: #fff; padding: 3px; text-align: center; font-weight: 800; border: 1px solid #000; margin-top: 10px; font-size: 12px; }

        /* ================== Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ================== */
        .data-row-container { display: flex; width: 100%; border: 1px solid #000; margin-bottom: 5px; background: #fff; flex-wrap: wrap; }
        .data-item { display: flex; flex-grow: 1; border-left: 1px solid #ccc; align-items: center; min-width: 100px; }
        .data-item:last-child { border-left: none; }
        .data-lbl { background: #eee; padding: 2px 4px; font-weight: 800; font-size: 11px; white-space: nowrap; }
        .data-val { flex-grow: 1; width: 100%; min-width: 40px; border: none; text-align: center; font-size: 12px; font-weight: 700; height: 22px; }

        /* Ø§Ù„Ø§Ù†Ø·Ø¨Ø§Ø¹Ø§Øª */
        .imp-grid { display: grid; grid-template-columns: repeat(2, 1fr); border: 1px solid #000; }
        .imp-item { display: flex; flex-direction: column; border: 1px solid #ccc; background: #fff; height: 50px; }
        .imp-lbl { background: #eee; border-bottom: 1px solid #ccc; text-align: center; font-weight: 800; font-size: 10px; }
        .imp-select { flex-grow: 1; font-weight: 700; }

        /* Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„ÙŠÙˆÙ…ÙŠ */
        .daily-wrapper { margin-top: 20px; break-before: page; page-break-before: always; }
        .daily-box { border: 2px solid #2c3e50; padding: 5px; background: #fff; }
        .daily-title-box { text-align: center; background: #e8f6f3; border: 2px solid #2c3e50; padding: 5px; margin-bottom: 5px; font-weight: 900; font-size: 14px; display: flex; flex-direction: column; align-items: center; gap: 5px; }
        .title-select { font-weight: 900; font-size: 14px; border: none; border-bottom: 2px solid #000; background: transparent; }
        .daily-grid { display: grid; grid-template-columns: 1fr; border: 1px solid #000; gap: 0; }
        .d-cell { display: flex; border: 1px solid #ccc; padding: 3px; align-items: center; flex-wrap: wrap; }
        .d-lbl { font-weight: 800; width: 110px; font-size: 11px; }
        
        .t-stat-box { display: flex; flex-direction: column; flex: 1; border-left: 1px solid #eee; align-items: center; }
        .t-stat-box:last-child { border-left: none; }
        .t-label { font-size: 9px; color: #555; margin-bottom: 2px; }
        .t-input { width: 100%; border: none; text-align: center; font-weight: bold; color: #000; font-size: 12px; }

        /* Ø§Ù„ØªÙˆÙ‚ÙŠØ¹Ø§Øª */
        .sig-container { display: grid; grid-template-columns: 1fr 1fr; gap: 5px; margin-top: 20px; }
        .sig-box { border: 1px solid #000; padding: 2px; text-align: center; background: #fff; position: relative; }
        .sig-select { 
            width: 100%; border: none; border-bottom: 1px solid #000; 
            font-weight: 800; height: 20px; font-size: 11px; 
            pointer-events: none; appearance: none; -webkit-appearance: none; background: transparent;
        }
        .name-inp { width: 100%; text-align: center; border: none; border-bottom: 1px dashed #999; height: 20px; font-size: 12px; font-weight: 700; }
        canvas { width: 100%; height: 50px; border: 1px dashed #ccc; cursor: crosshair; }
        .btn-clear-sig { position: absolute; bottom: 2px; left: 2px; background: rgba(192, 57, 43, 0.8); color: #fff; border: none; border-radius: 4px; padding: 1px 5px; font-size: 10px; cursor: pointer; z-index: 10; }

        .clean-input { border: none; border-bottom: 1px solid #eee; text-align: right; width: 100%; font-weight: 700; }
        .line-input { border: none; border-bottom: 1px dotted #000; text-align: right; width: 100%; font-weight: 700; }
        .btn-add { background: #eee; border: 1px solid #ccc; cursor: pointer; color: green; margin-right: 5px; font-size: 12px; padding: 0 5px; }
        .btn-del { background: #eee; border: 1px solid #ccc; cursor: pointer; color: red; margin-right: 5px; font-size: 12px; }
        .ro { background: #eee; font-weight: 800; color: #000; }
        .locked { background: #fffbe6; pointer-events: none; font-weight: 800; }
        .automation-footer { display: none; }

        /* ================== Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© (1.5cm Margin) ================== */
        @media print {
            @page { size: A4 landscape; margin: 1.5cm; }
            body { background: #fff; padding: 0; margin: 0; width: 100%; font-size: 14px !important; }
            .paper { box-shadow: none; margin: 0; padding: 0; width: 100%; max-width: none; }
            .toolbar, .no-print, .btn-add, .btn-del, .btn-clear-sig { display: none !important; }

            .layout-table { display: table !important; width: 100%; }
            .layout-table thead { display: table-header-group !important; }
            .layout-table tbody { display: table-row-group !important; }
            
            /* Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ù…Ø¤Ø´Ø±Ø§Øª */
            select { -webkit-appearance: none !important; -moz-appearance: none !important; appearance: none !important; background-image: none !important; padding: 0 !important; text-align-last: center; background-color: transparent !important; border: none !important; }
            /* Ø¥Ø®ÙØ§Ø¡ Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª Ø§Ù„ØªÙ‚ÙˆÙŠÙ… (ØªØ£ÙƒÙŠØ¯) */
            input[type="date"]::-webkit-calendar-picker-indicator,
            input[type="date"]::-webkit-inner-spin-button { display: none !important; -webkit-appearance: none !important; }

            /* Ø¶Ø¨Ø· Ø§Ù„Ø®Ø·ÙˆØ· */
            .data-table td input, .data-table td select, .data-table td { font-size: 12px !important; font-weight: 600; color: #000; height: 21px !important; }
            .data-table th { font-size: 11px !important; color: #000; }
            .head-bar { background: #e0e0e0 !important; color: #000 !important; font-size: 14px !important; font-weight: 900 !important; border: 2px solid #000 !important; -webkit-print-color-adjust: exact; margin-top: 5px !important; }
            .header-right, .header-left, .hl-inp, .hl-title { font-size: 14px !important; color: #000; }
            .main-title { font-size: 16px !important; font-weight: 900 !important; border: 2px solid #000 !important; }
            
            .data-lbl, .data-val, .d-lbl, .daily-grid input, .daily-grid select { font-size: 14px !important; font-weight: 600; color: #000; }
            .daily-title-box, .title-select { font-size: 16px !important; font-weight: 900 !important; color: #000; }
            .name-inp, .sig-select { font-size: 14px !important; color: #000; }

            /* Ø¥Ø®ÙØ§Ø¡ Ø¥Ø·Ø§Ø±Ø§Øª Ø§Ù„ØªÙˆÙ‚ÙŠØ¹ */
            .sig-box { border: none !important; }

            /* Ø§Ù„Ù‡ÙŠÙƒÙ„Ø© */
            .data-row-container { flex-wrap: nowrap !important; }
            .info-grid { grid-template-columns: repeat(3, 1fr); }
            .imp-grid { grid-template-columns: repeat(5, 1fr); } 
            .daily-grid { grid-template-columns: 1fr 1fr; }
            .daily-title-box { flex-direction: row; justify-content: center; gap: 10px; }
            .sig-container { grid-template-columns: repeat(4, 1fr); gap: 10px; }

            /* Ù…Ù†Ø¹ Ù‚Øµ Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ */
            .data-table { page-break-inside: avoid !important; }
            .data-table tr { page-break-inside: avoid !important; }
            .scroll-box { page-break-inside: avoid !important; overflow: visible !important; border: none; margin-bottom: 2px !important; }

            /* Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„ÙŠÙˆÙ…ÙŠ: ÙØ§ØµÙ„ ØµÙØ­Ø© */
            .daily-wrapper { break-before: page !important; page-break-before: always !important; }
            .daily-box { border: 2px solid #000 !important; margin-top: 0 !important; }

            /* Ø§Ù„ØªØ°ÙŠÙŠÙ„ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ */
            .automation-footer {
                display: block !important; width: 100%; text-align: left !important; padding-left: 20px;
                font-size: 10px !important; font-family: 'Arial', sans-serif; margin-top: 30px; color: #000;
                direction: ltr !important;
            }
        }
    </style>
</head>
<body>

    <div class="toolbar no-print">
        <button class="btn btn-share" onclick="shareReport()">Ù…Ø´Ø§Ø±ÙƒØ© ğŸ”—</button>
        <button class="btn btn-print" onclick="window.print()">Ø·Ø¨Ø§Ø¹Ø© ğŸ–¨ï¸</button>
        <button class="btn btn-reset" onclick="resetData()">ØªØµÙÙŠØ± ğŸ—‘ï¸</button>
    </div>

    <div class="paper">
        <table class="layout-table">
            <thead>
                <tr>
                    <th>
                        <div class="header-container">
                            <div class="header-right">
                                Ø§Ù„Ø¬Ù…Ù‡ÙˆØ±ÙŠØ© Ø§Ù„ÙŠÙ…Ù†ÙŠØ©<br>ÙˆØ²Ø§Ø±Ø© Ø§Ù„ØªØ±Ø¨ÙŠØ© ÙˆØ§Ù„ØªØ¹Ù„ÙŠÙ…<br>Ù…ÙƒØªØ¨ Ø§Ù„ØªØ±Ø¨ÙŠØ© ÙˆØ§Ù„ØªØ¹Ù„ÙŠÙ… ØªØ¹Ø²<br>Ø´Ø¹Ø¨Ø© Ø§Ù„Ù…Ù†Ø§Ù‡Ø¬ ÙˆØ§Ù„ØªÙˆØ¬ÙŠÙ‡<br>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ Ø§Ù„ØªØ±Ø¨ÙˆÙŠ
                            </div>
                            <div class="header-center">
                                <img src="https://upload.wikimedia.org/wikipedia/commons/c/c3/Emblem_of_Yemen_%282%29.svg" class="yemen-logo">
                                <div class="basmala">Ø¨Ø³Ù… Ø§Ù„Ù„Ù‡ Ø§Ù„Ø±Ø­Ù…Ù† Ø§Ù„Ø±Ø­ÙŠÙ…</div>
                                <div class="main-title">Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠ Ø§Ù„Ø°ÙƒÙŠ</div>
                            </div>
                            <div class="header-left">
                                <div class="hl-box">
                                    <div class="hl-title">Ù†Ù…ÙˆØ°Ø¬ Ø¢Ù„ÙŠ</div>
                                    <div class="hl-row"><span>Ø§Ù„ØªØ§Ø±ÙŠØ®:</span><input type="text" id="autoDate" class="hl-inp" readonly></div>
                                    <div class="hl-row"><span>Ø§Ù„Ù…Ø±ÙÙ‚Ø§Øª:</span><input type="text" class="hl-inp auto-save" placeholder="...................."></div>
                                </div>
                            </div>
                        </div>
                    </th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>
                        <div class="data-row-container">
                            <div class="data-item"><div class="data-lbl">Ø§Ù„Ù…Ø¯Ø±Ø³Ø©</div><input class="data-val auto-save" id="sc_n"></div>
                            <div class="data-item"><div class="data-lbl">Ø§Ù„Ù…Ø¯ÙŠØ±ÙŠØ©</div><input class="data-val auto-save"></div>
                            <div class="data-item"><div class="data-lbl">Ø§Ù„ÙØªØ±Ø©</div><select class="data-val auto-save"><option></option><option>ØµØ¨Ø§Ø­ÙŠ</option><option>Ù…Ø³Ø§Ø¦ÙŠ</option></select></div>
                            <div class="data-item"><div class="data-lbl">Ø§Ù„Ù†ÙˆØ¹</div><select class="data-val auto-save"><option></option><option>Ø­ÙƒÙˆÙ…ÙŠ</option><option>Ø£Ù‡Ù„ÙŠ</option></select></div>
                            <div class="data-item"><div class="data-lbl">Ø§Ù„Ù…Ø±Ø­Ù„Ø©</div><select class="data-val auto-save"><option></option><option>Ø£Ø³Ø§Ø³ÙŠ</option><option>Ø«Ø§Ù†ÙˆÙŠ</option><option>Ù…ÙˆØ­Ø¯</option></select></div>
                            <div class="data-item"><div class="data-lbl">Ù‡Ø§ØªÙ</div><input type="tel" class="data-val auto-save"></div>
                            <div class="data-item"><div class="data-lbl">Øª.Ø²ÙŠØ§Ø±Ø©</div><input type="date" class="data-val auto-save" id="visitDate"></div>
                        </div>

                        <div class="data-row-container">
                            <div class="data-item" style="flex-grow:2"><div class="data-lbl">Ø§Ù„Ù…Ø¯ÙŠØ±</div><input class="data-val auto-save"></div>
                            <div class="data-item"><div class="data-lbl">Ø±Ù‚Ù… Ù…Ø§Ù„ÙŠ</div><input type="number" class="data-val auto-save"></div>
                            <div class="data-item"><div class="data-lbl">Ø§Ù„Ù…Ø¤Ù‡Ù„</div><input class="data-val auto-save"></div>
                            <div class="data-item"><div class="data-lbl">Øª.ØªØ¹ÙŠÙŠÙ†</div><input type="date" class="data-val auto-save"></div>
                            <div class="data-item"><div class="data-lbl">Ø§Ù„Ø®Ø¨Ø±Ø©</div><input class="data-val auto-save"></div>
                            <div class="data-item"><div class="data-lbl">Ù‡Ø§ØªÙ</div><input type="tel" class="data-val auto-save"></div>
                        </div>

                        <div class="head-bar">Ø£ÙˆÙ„Ø§Ù‹: Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø¯Ø±Ø³Ø©</div>
                        <div class="scroll-box">
                            <table class="data-table" id="tbl-adm">
                                <thead>
                                    <tr>
                                        <th rowspan="2" class="sticky">Ø§Ù„ØµÙØ©</th>
                                        <th colspan="2">Ù…Ø¯ÙŠØ±</th><th colspan="2">ÙˆÙƒÙŠÙ„</th><th colspan="2">Ø¥Ø¯Ø§Ø±ÙŠ</th><th colspan="2">Ù…Ø´Ø±Ù</th>
                                        <th colspan="2" style="background:#d4e6f1">Ù…Ø¹Ù„Ù…</th><th colspan="2">Ø£Ø®Ø±Ù‰</th><th colspan="2">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹</th>
                                    </tr>
                                    <tr><th>Ø°</th><th>Ø«</th><th>Ø°</th><th>Ø«</th><th>Ø°</th><th>Ø«</th><th>Ø°</th><th>Ø«</th><th>Ø°</th><th>Ø«</th><th>Ø°</th><th>Ø«</th><th>Ø°</th><th>Ø«</th></tr>
                                </thead>
                                <tbody>
                                    <tr id="r-pres"><td class="sticky">Ø­Ø§Ø¶Ø±</td></tr>
                                    <tr id="r-abs"><td class="sticky">ØºØ§Ø¦Ø¨</td></tr>
                                    <tr style="background:#ddd"><td class="sticky">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹</td></tr>
                                </tbody>
                            </table>
                        </div>

                        <div class="head-bar">Ø«Ø§Ù†ÙŠØ§Ù‹: Ø¥Ø­ØµØ§Ø¦ÙŠØ© Ø§Ù„Ø·Ù„Ø§Ø¨</div>
                        <div class="scroll-box">
                            <table class="data-table" id="tbl-std">
                                <thead>
                                    <tr>
                                        <th rowspan="3" class="sticky">Ø§Ù„Ø¨ÙŠØ§Ù†</th>
                                        <th colspan="8">Ø±ÙŠØ§Ø¶ Ø§Ù„Ø£Ø·ÙØ§Ù„</th>
                                        <th colspan="20">Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ</th>
                                        <th colspan="12">Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ</th>
                                        <th colspan="3" rowspan="2">Ø§Ù„ÙƒÙ„ÙŠ</th>
                                    </tr>
                                    <tr>
                                        <th colspan="2">3-4</th><th colspan="2">4-5</th><th colspan="2">5-6</th><th colspan="2" style="background:#ddd">Ù…Ø¬</th>
                                        <th colspan="2">1</th><th colspan="2">2</th><th colspan="2">3</th><th colspan="2">4</th><th colspan="2">5</th><th colspan="2">6</th><th colspan="2">7</th><th colspan="2">8</th><th colspan="2">9</th><th colspan="2" style="background:#ddd">Ù…Ø¬</th>
                                        <th colspan="2">10</th><th colspan="2">11Ø¹</th><th colspan="2">11Ø£</th><th colspan="2">12Ø¹</th><th colspan="2">12Ø£</th><th colspan="2" style="background:#ddd">Ù…Ø¬</th>
                                    </tr>
                                    <tr id="h-gen"></tr>
                                </thead>
                                <tbody>
                                    <tr id="b-cnt"><td class="sticky">Ø§Ù„Ø¹Ø¯Ø¯</td></tr>
                                    <tr id="b-sum" style="background:#fffde7"><td class="sticky">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹</td></tr>
                                    <tr id="b-sec"><td class="sticky">Ø§Ù„Ø´Ø¹Ø¨</td></tr>
                                </tbody>
                            </table>
                        </div>

                        <div class="head-bar">Ø«Ø§Ù„Ø«Ø§Ù‹: Ø§Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ© Ø§Ù„Ø¹Ø§Ù…Ø© (Ø§Ù„Ù…Ø¹Ù„Ù…ÙˆÙ† ÙˆØ§Ù„ÙƒØªØ¨)</div>
                        <div class="scroll-box">
                            <table class="data-table" id="tbl-bud">
                                <thead>
                                    <tr>
                                        <th rowspan="2" class="sticky">Ø§Ù„Ù…Ø§Ø¯Ø©</th>
                                        <th colspan="5" style="background:#d6eaf8">Ø§Ù„Ù…Ø¹Ù„Ù…ÙˆÙ†</th>
                                        <th colspan="15">Ù†Ø³Ø¨Ø© Ø¹Ø¬Ø² Ø§Ù„ÙƒØªØ¨ %</th>
                                    </tr>
                                    <tr>
                                        <th width="35">Ø¹Ø¯Ø¯</th><th width="35">Ù…Ø·Ù„ÙˆØ¨</th><th width="35">Ù…ÙˆØ¬ÙˆØ¯</th><th width="35">Ø¹Ø¬Ø²</th><th width="35">Ø²Ø§Ø¦Ø¯</th>
                                        <th>1</th><th>2</th><th>3</th><th>4</th><th>5</th><th>6</th><th>7</th><th>8</th><th>9</th><th style="background:#eee">Ù…Ø¬</th>
                                        <th>10</th><th>11Ø¹</th><th>11Ø£</th><th>12Ø¹</th><th>12Ø£</th>
                                    </tr>
                                </thead>
                                <tbody id="tb-bud"></tbody>
                            </table>
                        </div>

                        <div class="head-bar" style="margin-top:10px;">ØºØ±Ù Ø§Ù„Ù…Ø¨Ù†Ù‰</div>
                        <div class="scroll-box">
                            <table class="data-table">
                                <tr><th class="sticky">Ø§Ù„Ø¨ÙŠØ§Ù†</th><th>Ø¥Ø¯Ø§Ø±Ø©</th><th>ÙØµÙˆÙ„</th><th>Ø£Ù†Ø´Ø·Ø©</th><th>Ù…Ø®Ø§Ø²Ù†</th><th>ØµØ­ÙŠØ©</th><th>Ø£Ø®Ø±Ù‰</th><th>Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th></tr>
                                <tr><td class="sticky">Ø§Ù„Ø¹Ø¯Ø¯</td>
                                <td><input type="number" class="rm auto-save"></td><td><input type="number" class="rm auto-save"></td>
                                <td><input type="number" class="rm auto-save"></td><td><input type="number" class="rm auto-save"></td>
                                <td><input type="number" class="rm auto-save"></td><td><input type="number" class="rm auto-save"></td>
                                <td><input type="text" lang="en" class="ro" id="rm-tot" readonly></td></tr>
                            </table>
                        </div>

                        <div class="head-bar" style="margin-top:10px;">Ø§Ù„Ø§Ù†Ø·Ø¨Ø§Ø¹Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø©</div>
                        <div class="imp-grid">
                            <div class="imp-item"><div class="imp-lbl">Ø§Ù„Ù…Ø¨Ù†Ù‰</div><select class="imp-select auto-save"><option></option><option>ØµØ§Ù„Ø­</option><option>ØºÙŠØ± ØµØ§Ù„Ø­</option><option>ÙŠØ­ØªØ§Ø¬ ØªØ±Ù…ÙŠÙ…</option><option>Ø¥Ø¶Ø§ÙØ© ÙØµÙˆÙ„</option><option>ÙŠØ­ØªØ§Ø¬ Ø³ÙˆØ± Ù„Ù„Ù…Ø¯Ø±Ø³Ø©</option></select></div>
                            <div class="imp-item"><div class="imp-lbl">Ø§Ù„Ø£Ø«Ø§Ø«</div><select class="imp-select auto-save"><option></option><option>Ù…ØªÙˆÙØ±</option><option>ØºÙŠØ± Ù…ØªÙˆÙØ±</option><option>Ø¹Ø¬Ø²</option></select></div>
                            <div class="imp-item"><div class="imp-lbl">Ø§Ù„Ø³Ø¬Ù„Ø§Øª</div><select class="imp-select auto-save"><option></option><option>Ù…ØªÙˆÙØ±Ø©</option><option>ØºÙŠØ± Ù…ØªÙˆÙØ±Ø©</option><option>Ø¹Ø¬Ø²</option></select></div>
                            <div class="imp-item"><div class="imp-lbl">Ø§Ù„Ø®Ø·Ø©</div><select class="imp-select auto-save"><option></option><option>Ù…ÙØ¹Ù„Ø©</option><option>ØºÙŠØ± Ù…ÙØ¹Ù„Ø©</option></select></div>
                            <div class="imp-item"><div class="imp-lbl">Ø§Ù„Ø·Ø§Ø¨ÙˆØ±</div><select class="imp-select auto-save"><option></option><option>Ù…Ù†ØªØ¸Ù…</option><option>ØºÙŠØ± Ù…Ù†ØªØ¸Ù…</option></select></div>
                            <div class="imp-item"><div class="imp-lbl">Ø§Ù„Ø¥Ø°Ø§Ø¹Ø©</div><select class="imp-select auto-save"><option></option><option>Ù…ÙØ¹Ù„Ø©</option><option>ØºÙŠØ± Ù…ÙØ¹Ù„Ø©</option></select></div>
                            <div class="imp-item"><div class="imp-lbl">Ø§Ù„ÙƒØªØ¨</div><select class="imp-select auto-save"><option></option><option>ÙˆØµÙ„Øª</option><option>Ù„Ù… ØªØµÙ„</option></select></div>
                            <div class="imp-item"><div class="imp-lbl">Ø§Ù„Ù…Ø®ØªØ¨Ø±</div><select class="imp-select auto-save"><option></option><option>Ù…ÙØ¹Ù„</option><option>ØºÙŠØ± Ù…ÙØ¹Ù„</option><option>ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯</option></select></div>
                            <div class="imp-item"><div class="imp-lbl">Ø£Ù…ÙŠÙ† Ù…Ø®ØªØ¨Ø±</div><select class="imp-select auto-save"><option></option><option>Ù…ÙˆØ¬ÙˆØ¯</option><option>ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯</option></select></div>
                            <div class="imp-item"><div class="imp-lbl">Ø§Ù„Ù…ÙƒØªØ¨Ø©</div><select class="imp-select auto-save"><option></option><option>Ù…ÙØ¹Ù„Ø©</option><option>ØºÙŠØ± Ù…ÙØ¹Ù„Ø©</option><option>ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø©</option></select></div>
                        </div>

                        <div style="margin-top:10px; border-bottom:1px solid #000; display:flex; justify-content:space-between; align-items:center;">
                            <strong>Ø£Ù†Ø´Ø·Ø© Ø£Ø®Ø±Ù‰:</strong> <button class="btn-add no-print" onclick="addLn('act-box','clean')">+</button>
                        </div>
                        <div id="act-box"></div>

                        <div class="daily-wrapper">
                            <div class="daily-box">
                                <div class="daily-title-box">
                                    <div>Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„ÙŠÙˆÙ…ÙŠ</div>
                                    <select class="title-select auto-save" id="repTitle" onchange="checkSig()">
                                        <option value="central">Ù„Ù„Ù…ÙˆØ¬Ù‡ Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ Ø¹Ù† Ø§Ù„Ø²ÙŠØ§Ø±Ø© Ø§Ù„Ø§Ø³ØªØ·Ù„Ø§Ø¹ÙŠØ©</option>
                                        <option value="local">Ù„Ù„Ù…ÙˆØ¬Ù‡ Ø§Ù„Ù…Ø­Ù„ÙŠ Ø¹Ù† Ø§Ù„Ø²ÙŠØ§Ø±Ø© Ø§Ù„Ø§Ø³ØªØ·Ù„Ø§Ø¹ÙŠØ©</option>
                                    </select>
                                </div>

                                <div style="background:#eee; padding:2px; font-weight:bold;">Ø£ÙˆÙ„Ø§Ù‹: Ø§Ù„Ø§Ù†ØªØ¸Ø§Ù…</div>
                                <div class="daily-grid">
                                    <div class="d-cell" style="display:block">
                                        <div style="display:flex; align-items:center; margin-bottom:5px;">
                                            <span class="d-lbl">Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©:</span>
                                            <select class="auto-save" style="flex-grow:1"><option></option><option>Ù…ÙˆØ¬ÙˆØ¯Ø©</option><option>ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø©</option></select>
                                            <button class="btn-add no-print" onclick="addLn('adm-note-box','clean')">+</button>
                                        </div>
                                        <div id="adm-note-box"></div>
                                    </div>
                                    
                                    <div class="d-cell" style="padding:0;">
                                        <div style="width:100px; font-weight:bold; font-size:11px; padding:3px; background:#f9f9f9;">Ø§Ù„Ù…Ø¹Ù„Ù…ÙŠÙ†:</div>
                                        <div style="display:flex; flex:1; height:100%;">
                                            <div class="t-stat-box"><span class="t-label">Ø­Ø§Ø¶Ø±</span><input type="text" lang="en" id="dt-p" class="t-input locked" readonly></div>
                                            <div class="t-stat-box"><span class="t-label">ØºØ§Ø¦Ø¨</span><input type="text" lang="en" id="dt-a" class="t-input locked" readonly></div>
                                            <div class="t-stat-box"><span class="t-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ</span><input type="text" lang="en" id="dt-t" class="t-input locked" readonly></div>
                                        </div>
                                    </div>

                                    <div class="d-cell" style="grid-column:span 2">
                                        <span class="d-lbl">Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„ØºÙŠØ§Ø¨:</span>
                                        <div id="abs-box" style="flex-grow:1"><button class="btn-add no-print" onclick="addLn('abs-box','line')">+</button></div>
                                    </div>
                                    <div class="d-cell"><span class="d-lbl">Ù†Ø³Ø¨Ø© Ø§Ù„Ø·Ù„Ø§Ø¨:</span><input class="auto-save" placeholder="%"></div>
                                    
                                    <div class="d-cell" style="display:block">
                                        <div style="display:flex; align-items:center; margin-bottom:5px;">
                                            <span class="d-lbl" style="width:auto; margin-left:5px;">Ù…Ø·Ø§Ø¨Ù‚Ø© Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ù„Ù„Ø®Ø·Ø© Ø§Ù„Ù…Ø¯Ø±Ø³ÙŠØ©:</span>
                                            <select class="auto-save" style="flex-grow:1">
                                                <option></option>
                                                <option>Ù…Ø·Ø§Ø¨Ù‚</option>
                                                <option>ØºÙŠØ± Ù…Ø·Ø§Ø¨Ù‚</option>
                                            </select>
                                            <button class="btn-add no-print" onclick="addLn('sch-note-box','clean')">+</button>
                                        </div>
                                        <div id="sch-note-box"></div>
                                    </div>
                                </div>

                                <div style="background:#eee; padding:2px; font-weight:bold; margin-top:5px;">Ø«Ø§Ù„Ø«Ø§Ù‹: Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª <button class="btn-add no-print" onclick="addLn('not-box','clean')">+</button></div>
                                <div id="not-box"></div>

                                <div style="background:#eee; padding:2px; font-weight:bold; margin-top:5px;">Ø±Ø§Ø¨Ø¹Ø§Ù‹: Ø§Ù„ØªÙˆØµÙŠØ§Øª <button class="btn-add no-print" onclick="addLn('rec-box','clean')">+</button></div>
                                <div id="rec-box"></div>

                                <div class="sig-container">
                                    <div class="sig-box">
                                        <select class="sig-select" id="sig1">
                                            </select>
                                        <input class="name-inp auto-save" placeholder="................">
                                        <canvas></canvas>
                                        <button class="btn-clear-sig no-print" onclick="clearCanvas(this)">x</button>
                                    </div>
                                    <div class="sig-box">
                                        <select class="sig-select" id="sig2">
                                            </select>
                                        <input class="name-inp auto-save" placeholder="................">
                                        <canvas></canvas>
                                        <button class="btn-clear-sig no-print" onclick="clearCanvas(this)">x</button>
                                    </div>
                                    <div class="sig-box">
                                        <select class="sig-select" id="sig3">
                                            </select>
                                        <input class="name-inp auto-save" placeholder="................">
                                        <canvas></canvas>
                                        <button class="btn-clear-sig no-print" onclick="clearCanvas(this)">x</button>
                                    </div>
                                    <div class="sig-box" id="sig-box-4">
                                        <select class="sig-select" id="sig4">
                                            </select>
                                        <input class="name-inp auto-save" placeholder="................">
                                        <canvas></canvas>
                                        <button class="btn-clear-sig no-print" onclick="clearCanvas(this)">x</button>
                                    </div>
                                </div>
                                <div class="automation-footer">Ø£ØªÙ…ØªØ© Ù†Ø¬Ø§Ø© Ø´Ù…Ø³Ø§Ù†</div>
                            </div>
                        </div>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>

<script>
    document.getElementById('autoDate').value = new Date().toLocaleDateString('ar-YE');
    document.getElementById('visitDate').valueAsDate = new Date();

    const rP=document.getElementById('r-pres'), rA=document.getElementById('r-abs'), rT=rP.parentElement.lastElementChild;
    for(let i=0; i<14; i++){
        let cls=i<12?`ia c${i} auto-save`:`ro t${i}`;
        rP.insertAdjacentHTML('beforeend',`<td><input type="number" class="${cls}"></td>`);
        rA.insertAdjacentHTML('beforeend',`<td><input type="number" class="${cls}"></td>`);
        rT.insertAdjacentHTML('beforeend',`<td><input type="text" lang="en" class="ro vt${i}" readonly></td>`);
    }

    const st=[{id:'k',n:3},{id:'b',n:9},{id:'s',n:5}], hG=document.getElementById('h-gen'), bC=document.getElementById('b-cnt'), bS=document.getElementById('b-sum'), bSec=document.getElementById('b-sec');
    st.forEach(s=>{
        for(let i=0; i<s.n; i++){
            hG.insertAdjacentHTML('beforeend',`<th>Ø°</th><th>Ù†</th>`);
            bC.insertAdjacentHTML('beforeend',`<td><input type="number" class="st ${s.id}m${i} auto-save"></td><td><input type="number" class="st ${s.id}f${i} auto-save"></td>`);
            bS.insertAdjacentHTML('beforeend',`<td colspan="2"><input type="text" lang="en" class="ro ${s.id}t${i}" readonly></td>`);
            bSec.insertAdjacentHTML('beforeend',`<td colspan="2"><input type="number" class="auto-save"></td>`);
        }
        hG.insertAdjacentHTML('beforeend',`<th style="background:#ddd">Ø°</th><th style="background:#ddd">Ù†</th>`);
        bC.insertAdjacentHTML('beforeend',`<td><input type="text" lang="en" class="ro sm${s.id}" readonly></td><td><input type="text" lang="en" class="ro sf${s.id}" readonly></td>`);
        bS.insertAdjacentHTML('beforeend',`<td colspan="2" style="background:#ccc"></td>`); bSec.insertAdjacentHTML('beforeend',`<td colspan="2" style="background:#ccc"></td>`);
    });
    hG.insertAdjacentHTML('beforeend',`<th style="background:#999">Ø°</th><th style="background:#999">Ù†</th><th style="background:#666;color:#fff">ÙƒÙ„ÙŠ</th>`);
    bC.insertAdjacentHTML('beforeend',`<td><input type="text" lang="en" class="ro gm" readonly></td><td><input type="text" lang="en" class="ro gf" readonly></td><td rowspan="3" class="ro" style="background:#666;color:#fff" id="sup">0</td>`);
    bS.insertAdjacentHTML('beforeend',`<td colspan="2" style="background:#999"></td>`); bSec.insertAdjacentHTML('beforeend',`<td colspan="2" style="background:#999"></td>`);
    
    const subs=["Ø§Ù„Ù‚Ø±Ø¢Ù† Ø§Ù„ÙƒØ±ÙŠÙ…","Ø§Ù„ØªØ±Ø¨ÙŠØ© Ø§Ù„Ø¥Ø³Ù„Ø§Ù…ÙŠØ©","Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©","Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©","Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª","Ø§Ù„Ø¹Ù„ÙˆÙ… (1-9)","Ø§Ù„ÙÙŠØ²ÙŠØ§Ø¡","Ø§Ù„ÙƒÙŠÙ…ÙŠØ§Ø¡","Ø§Ù„Ø£Ø­ÙŠØ§Ø¡","Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠØ§Øª","Ø§Ù„ØªØ§Ø±ÙŠØ®","Ø§Ù„Ø¬ØºØ±Ø§ÙÙŠØ§","ÙÙ„Ø³ÙØ©","Ø¹Ù„Ù… Ù†ÙØ³","Ù…Ø¬ØªÙ…Ø¹","Ø§Ø¬ØªÙ…Ø§Ø¹","Ø§Ù‚ØªØµØ§Ø¯","ØµÙÙˆÙ Ø£ÙˆÙ„ÙŠØ©","Ø®Ø¯Ù…Ø© Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠØ©","Ø£Ù†Ø´Ø·Ø©","ÙÙ†ÙŠØ©","Ø±ÙŠØ§Ø¶ÙŠØ©","Ù…Ù‡Ù†ÙŠØ©","Ù…ÙˆØ³ÙŠÙ‚ÙŠØ©","Ø­Ø§Ø³ÙˆØ¨","Ø£Ø®Ø±Ù‰"];
    const tB=document.getElementById('tb-bud');
    subs.forEach((s,i)=>{
        let tr=document.createElement('tr');
        tr.innerHTML=`<td class="sticky">${s}</td><td><input type="number" class="auto-save"></td><td><input type="number" id="rq${i}" class="auto-save" oninput="cB(${i})"></td><td><input type="number" id="av${i}" class="auto-save" oninput="cB(${i})"></td><td><input type="text" lang="en" id="df${i}" class="ro" readonly></td><td><input type="text" lang="en" id="sr${i}" class="ro" readonly></td>${'<td><input type="number" class="auto-save"></td>'.repeat(15)}`;
        tB.appendChild(tr);
    });

    let totalTr = document.createElement('tr');
    totalTr.style.background = '#bbb';
    totalTr.innerHTML = `<td class="sticky" style="font-weight:900;">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</td>${'<td><input type="text" lang="en" class="ro" style="font-weight:900;" readonly></td>'.repeat(20)}`;
    tB.appendChild(totalTr);

    window.resetData = function() {
        if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØªØµÙÙŠØ± Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ØŸ')) return;
        localStorage.clear();
        document.querySelectorAll('input, select').forEach(el => {
            if (el.id !== 'autoDate' && el.id !== 'visitDate') { 
                if(el.type === 'checkbox' || el.type === 'radio') el.checked = false;
                else el.value = '';
            }
        });
        document.querySelectorAll('canvas').forEach(c => {
            let ctx = c.getContext('2d');
            ctx.clearRect(0, 0, c.width, c.height);
        });
        document.querySelectorAll('.dyn-line').forEach(el => el.remove());
        document.getElementById('repTitle').value = 'central'; 
        checkSig(); 
        document.getElementById('autoDate').value = new Date().toLocaleDateString('ar-YE');
        document.getElementById('visitDate').valueAsDate = new Date();
        calcTeach();
    }

    document.querySelectorAll('.ia').forEach(el=>el.addEventListener('input',()=>{
        for(let c=0; c<12; c++){
            let p=parseFloat(document.querySelector(`#r-pres .c${c}`).value)||0;
            let a=parseFloat(document.querySelector(`#r-abs .c${c}`).value)||0;
            document.querySelector(`.vt${c}`).value=p+a;
        }
        calcTeach();
    }));
    function calcTeach() {
        let pm=parseFloat(document.querySelector('.c8').value)||0, pf=parseFloat(document.querySelector('.c9').value)||0;
        let am=parseFloat(document.querySelectorAll('.c8')[1].value)||0, af=parseFloat(document.querySelectorAll('.c9')[1].value)||0;
        document.getElementById('dt-p').value = pm+pf;
        document.getElementById('dt-a').value = am+af;
        document.getElementById('dt-t').value = (pm+pf)+(am+af);
    }
    
    document.querySelectorAll('.st').forEach(e=>e.addEventListener('input',()=>{
        let tm=0, tf=0;
        st.forEach(s=>{
            let sm=0, sf=0;
            for(let i=0; i<s.n; i++){
                let m=parseFloat(document.querySelector(`.${s.id}m${i}`).value)||0, f=parseFloat(document.querySelector(`.${s.id}f${i}`).value)||0;
                document.querySelector(`.${s.id}t${i}`).value=m+f; sm+=m; sf+=f;
            }
            document.querySelector(`.sm${s.id}`).value=sm; document.querySelector(`.sf${s.id}`).value=sf; tm+=sm; tf+=sf;
        });
        document.querySelector('.gm').value=tm; document.querySelector('.gf').value=tf; document.getElementById('sup').innerText=tm+tf;
    }));

    function cB(i){
        let r=parseFloat(document.getElementById(`rq${i}`).value)||0, a=parseFloat(document.getElementById(`av${i}`).value)||0, d=document.getElementById(`df${i}`), s=document.getElementById(`sr${i}`);
        d.value=""; s.value=""; if(r>0||a>0){ let x=a-r; if(x<0){d.value=Math.abs(x);d.classList.add('def');}else{s.value=x;s.classList.add('sur');} }
    }
    document.querySelectorAll('.rm').forEach(e=>e.addEventListener('input',()=>{
        let t=0; document.querySelectorAll('.rm').forEach(x=>t+=(parseFloat(x.value)||0)); document.getElementById('rm-tot').value=t;
    }));

    window.syncSignatureTitle = function() {
        let titleVal = document.getElementById('reportTitleSelect').value;
        document.getElementById('sig1-select').value = titleVal;
    }

    window.checkSig = function() {
        let title = document.getElementById('repTitle').value;
        let s1 = document.getElementById('sig1');
        let s2 = document.getElementById('sig2');
        let s3 = document.getElementById('sig3');
        let s4 = document.getElementById('sig4');
        let box4 = document.getElementById('sig-box-4');

        if (title === 'local') {
            setOption(s1, "Ø§Ù„Ù…ÙˆØ¬Ù‡ Ø§Ù„Ù…Ø­Ù„ÙŠ");
            setOption(s2, "Ø±Ø¦ÙŠØ³ Ù‚Ø³Ù… Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ Ø¨Ø§Ù„Ù…Ø¯ÙŠØ±ÙŠØ©");
            setOption(s3, "Ù…Ø¯ÙŠØ± Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªØ±Ø¨ÙŠØ© ÙˆØ§Ù„ØªØ¹Ù„ÙŠÙ… Ø¨Ø§Ù„Ù…Ø¯ÙŠØ±ÙŠØ©");
            box4.style.display = 'none';
        } else {
            setOption(s1, "Ø§Ù„Ù…ÙˆØ¬Ù‡ Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ");
            setOption(s2, "Ø§Ù„Ù…Ù†Ø³Ù‚");
            setOption(s3, "Ø±Ø¦ÙŠØ³ Ù‚Ø³Ù… Ø§Ù„ØªÙˆØ¬ÙŠÙ‡");
            setOption(s4, "Ù…Ø¯ÙŠØ± Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ Ø§Ù„ØªØ±Ø¨ÙˆÙŠ");
            box4.style.display = 'block';
        }
    }

    function setOption(selectElement, text) {
        selectElement.innerHTML = `<option>${text}</option>`;
        selectElement.value = text;
    }

    window.clearCanvas = function(btn) {
        let canvas = btn.parentElement.querySelector('canvas');
        let ctx = canvas.getContext('2d');
        ctx.clearRect(0, 0, canvas.width, canvas.height);
    }

    window.addLn = function(id, type, val=''){
        let div = document.createElement('div');
        div.className = 'dyn-line';
        div.innerHTML=`<input type="text" class="${type==='clean'?'clean-input':'line-input'} auto-save-line" value="${val}" placeholder="..."><button class="btn-del no-print" onclick="this.parentElement.remove();saveLn()">x</button>`;
        document.getElementById(id).appendChild(div);
        saveLn();
    }
    window.saveLn = function(){
        ['act-box','abs-box','not-box','rec-box','adm-note-box','sch-note-box'].forEach(id=>{
            let v = Array.from(document.getElementById(id).querySelectorAll('input')).map(i=>i.value);
            localStorage.setItem('l_'+id, JSON.stringify(v));
        });
    }
    
    window.shareReport = async function() {
        if (navigator.share) {
            try { await navigator.share({ title: 'ØªÙ‚Ø±ÙŠØ± Ø¥Ø­ØµØ§Ø¦ÙŠ', url: window.location.href }); } catch (err) {}
        } else { alert('Ø§Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø· Ù…Ù† Ø§Ù„Ù…ØªØµÙØ­'); }
    }

    document.querySelectorAll('canvas').forEach(c=>{
        let ctx=c.getContext('2d'), p=false; 
        c.width=c.offsetWidth; c.height=c.offsetHeight;
        function draw(e){
            if(!p)return; e.preventDefault();
            let r=c.getBoundingClientRect();
            let clientX = e.clientX || (e.touches ? e.touches[0].clientX : 0);
            let clientY = e.clientY || (e.touches ? e.touches[0].clientY : 0);
            let x=clientX-r.left;
            let y=clientY-r.top;
            ctx.lineWidth=1.0; ctx.lineCap='round'; ctx.strokeStyle='#000080';
            ctx.lineTo(x,y); ctx.stroke(); ctx.beginPath(); ctx.moveTo(x,y);
        }
        c.addEventListener('mousedown',e=>{p=true;draw(e)}); 
        c.addEventListener('mouseup',()=>{p=false;ctx.beginPath()}); 
        c.addEventListener('mousemove',draw);
        c.addEventListener('touchstart',e=>{p=true;draw(e)}); 
        c.addEventListener('touchend',()=>{p=false;ctx.beginPath()}); 
        c.addEventListener('touchmove',draw);
    });

    window.addEventListener('load', () => {
        let inputs = document.querySelectorAll('.auto-save');
        inputs.forEach((inp, index) => {
            if (!inp.id) inp.id = 'gen_inp_' + index;
            if (localStorage.getItem(inp.id)) {
                inp.value = localStorage.getItem(inp.id);
                inp.dispatchEvent(new Event('input'));
            }
            inp.addEventListener('input', () => localStorage.setItem(inp.id, inp.value));
        });

        calcTeach();
        
        if (!document.getElementById('repTitle').value) document.getElementById('repTitle').value = 'central';
        checkSig();

        ['act-box','abs-box','not-box','rec-box','adm-note-box','sch-note-box'].forEach(id=>{
            let s=localStorage.getItem('l_'+id);
            if(s) JSON.parse(s).forEach(v=>addLn(id, id==='abs-box'?'line':'clean', v));
            else if(id !== 'adm-note-box' && id !== 'sch-note-box') addLn(id, id==='abs-box'?'line':'clean');
        });
    });
</script>

</body>
</html>
