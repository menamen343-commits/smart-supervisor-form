<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>استمارة الموجه الذكية</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f0eb;
            color: #000000;
            line-height: 1.6;
            padding: 15px;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .container {
            background-color: #fdf9f5;
            border-radius: 12px;
            box-shadow: 0 8px 25px rgba(139, 69, 19, 0.1);
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid #e6d5c9;
        }
        
        header {
            text-align: center;
            padding-bottom: 20px;
            border-bottom: 4px solid #8B4513;
            margin-bottom: 20px;
            background: linear-gradient(to left, #f5e9dc, #e6d5c9);
            border-radius: 10px;
            padding: 25px 20px;
        }
        
        h1 {
            color: #5D4037;
            font-size: 40px;
            margin-bottom: 10px;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.1);
            font-weight: 900;
        }
        
        .main-title {
            color: #000000;
            font-size: 36px;
            font-weight: 800;
            margin-top: 5px;
            margin-bottom: 10px;
        }
        
        /* قسم بيانات المعلم والموجه - تم تقليل الحجم */
        .info-section {
            background: linear-gradient(to left, #f5e9dc, #e6d5c9);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            border: 1px solid #d7c4b8;
        }
        
        .info-section h2 {
            color: #000000;
            margin-bottom: 12px;
            text-align: center;
            font-size: 20px;
            border-bottom: 2px solid #8B4513;
            padding-bottom: 6px;
            font-weight: 900;
        }
        
        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 12px;
        }
        
        .info-item {
            display: flex;
            align-items: center;
            padding: 8px;
            background-color: rgba(255, 255, 255, 0.9);
            border-radius: 8px;
            border: 1px solid #d7c4b8;
        }
        
        .info-label {
            font-weight: 900;
            color: #000000;
            min-width: 160px;
            margin-left: 8px;
            font-size: 14px;
        }
        
        .info-value {
            flex: 1;
            color: #000000;
            font-size: 14px;
        }
        
        .info-input {
            flex: 1;
            padding: 6px;
            border-radius: 5px;
            border: 1px solid #b89a84;
            font-size: 14px;
            background-color: #fff;
            color: #000000;
        }
        
        /* قسم المؤقتات */
        .timers-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            background: linear-gradient(to left, #f5e9dc, #e6d5c9);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 25px;
            border: 1px solid #d7c4b8;
        }
        
        .timer-box {
            background-color: #ffffff;
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(139, 69, 19, 0.08);
            border: 1px solid #d7c4b8;
        }
        
        .timer-title {
            font-size: 18px;
            color: #000000;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 900;
        }
        
        .timer-title i {
            margin-left: 10px;
        }
        
        .timer-display {
            font-size: 32px;
            font-weight: 900;
            color: #8B4513;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
        }
        
        .timer-controls {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-top: 10px;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 900;
            font-size: 14px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .btn i {
            margin-left: 5px;
        }
        
        .btn-start {
            background-color: #8B4513;
            color: #ffffff;
        }
        
        .btn-pause {
            background-color: #b08968;
            color: #000000;
        }
        
        .btn-reset {
            background-color: #5D4037;
            color: white;
        }
        
        .btn-calc {
            background-color: #8B4513;
            color: #ffffff;
        }
        
        .btn-clear {
            background-color: #8B4513;
            color: #ffffff;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        .interaction-indicator {
            padding: 15px;
            background-color: #ffffff;
            border-radius: 10px;
            text-align: center;
            border: 2px dashed #b08968;
        }
        
        .indicator-value {
            font-size: 24px;
            font-weight: 900;
            color: #000000;
            margin-top: 8px;
        }
        
        .indicator-bar {
            height: 15px;
            background: linear-gradient(to right, #e6d5c9, #8B4513);
            border-radius: 8px;
            margin-top: 8px;
            transition: width 1s ease;
        }
        
        /* تصميم الجدول المعدل */
        .evaluation-table-container {
            margin-top: 25px;
            overflow-x: auto;
            border-radius: 10px;
            border: 1px solid #d7c4b8;
        }
        
        .evaluation-table {
            width: 100%;
            border-collapse: collapse;
            min-width: 1000px;
        }
        
        .evaluation-table th {
            background: linear-gradient(to bottom, #8B4513, #5D4037);
            color: #ffffff;
            text-align: center;
            padding: 15px 10px;
            font-weight: 900;
            border: 1px solid #3E2723;
            position: sticky;
            top: 0;
            font-size: 18px;
        }
        
        .evaluation-table td {
            padding: 12px 10px;
            border: 1px solid #e6d5c9;
            vertical-align: top;
            color: #000000;
        }
        
        .domain-header {
            background-color: #FFFFFF !important;
            font-weight: 900;
            color: #00008B !important;
            font-size: 30px;
            padding: 15px;
            border-left: 5px solid #e6d5c9;
            letter-spacing: 0.5px;
        }
        
        .criterion-row {
            background-color: #ffffff;
        }
        
        .criterion-row:nth-child(even) {
            background-color: #ffffff;
        }
        
        .criterion-name {
            font-weight: 900;
            color: #000000;
            width: 100%;
            padding-bottom: 10px;
            border-bottom: 1px solid #d7c4b8;
            font-size: 17px;
        }
        
        .rating-cell {
            width: 100%;
            padding-top: 10px;
        }
        
        .rating-select {
            width: 100%;
            padding: 10px;
            border-radius: 6px;
            border: 2px solid #b08968;
            background-color: white;
            font-size: 15px;
            color: #000000;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 900;
        }
        
        .rating-select:focus {
            border-color: #8B4513;
            outline: none;
            box-shadow: 0 0 0 3px rgba(139, 69, 19, 0.1);
        }
        
        .rating-select option {
            padding: 10px;
        }
        
        /* تصنيفات التقييم */
        .rating-1 { background-color: #ffebee !important; }
        .rating-2 { background-color: #fff3e0 !important; }
        .rating-3 { background-color: #fffde7 !important; }
        .rating-4 { background-color: #f1f8e9 !important; }
        .rating-5 { background-color: #e8f5e9 !important; }
        
        .rating-1:checked, .rating-1:focus { border-color: #d32f2f; }
        .rating-2:checked, .rating-2:focus { border-color: #f57c00; }
        .rating-3:checked, .rating-3:focus { border-color: #ffb300; }
        .rating-4:checked, .rating-4:focus { border-color: #689f38; }
        .rating-5:checked, .rating-5:focus { border-color: #388e3c; }
        
        .rating-details {
            margin-top: 8px;
            padding: 8px;
            background-color: #f5e9dc;
            border-radius: 5px;
            border-right: 3px solid #d7c4b8;
            font-size: 14px;
            color: #000000;
            display: none;
        }
        
        .rating-details.show {
            display: block;
        }
        
        .domain-summary {
            background-color: #e6d5c9 !important;
            font-weight: 900;
            padding: 12px;
            text-align: center;
            font-size: 17px;
            color: #000000;
            border-top: 2px solid #8B4513;
        }
        
        .domain-score {
            color: #5D4037;
            font-weight: 900;
            font-size: 19px;
            margin-right: 10px;
        }
        
        /* قسم الملاحظات */
        .notes-section {
            margin-top: 30px;
            padding: 20px;
            background-color: #f5e9dc;
            border-radius: 10px;
            border: 2px dashed #b08968;
        }
        
        .notes-title {
            color: #000000;
            font-size: 20px;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            font-weight: 900;
        }
        
        .notes-title i {
            margin-left: 10px;
        }
        
        textarea {
            width: 100%;
            padding: 12px;
            border-radius: 8px;
            border: 1px solid #b08968;
            font-size: 15px;
            margin-bottom: 12px;
            resize: vertical;
            min-height: 100px;
            font-family: inherit;
            background-color: #ffffff;
            color: #000000;
        }
        
        .record-controls {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        
        .btn-record {
            background-color: #8B4513;
            color: #ffffff;
        }
        
        .btn-record.recording {
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0% { background-color: #8B4513; }
            50% { background-color: #b08968; }
            100% { background-color: #8B4513; }
        }
        
        .btn-stop {
            background-color: #b08968;
            color: #000000;
        }
        
        /* أزرار الإجراءات */
        .action-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 30px;
        }
        
        .action-btn {
            padding: 12px 20px;
            font-size: 16px;
            min-width: 180px;
            justify-content: center;
            font-weight: 900;
        }
        
        .btn-generate {
            background: linear-gradient(to right, #8B4513, #b08968);
            color: #ffffff;
        }
        
        .btn-feedback {
            background: linear-gradient(to right, #5D4037, #8B4513);
            color: white;
        }
        
        .btn-chart {
            background: linear-gradient(to right, #3E2723, #5D4037);
            color: white;
        }
        
        .btn-save {
            background: linear-gradient(to right, #6D4C41, #8B4513);
            color: white;
        }
        
        .btn-print {
            background: linear-gradient(to right, #A1887F, #8B4513);
            color: #ffffff;
        }
        
        .btn-share {
            background: linear-gradient(to right, #8D6E63, #6D4C41);
            color: #ffffff;
        }
        
        .btn-clear {
            background: linear-gradient(to right, #A1887F, #8B4513);
            color: #ffffff;
        }
        
        /* قسم النتائج */
        .result-section {
            margin-top: 30px;
            padding: 20px;
            background-color: #ffffff;
            border-radius: 10px;
            border: 2px solid #8B4513;
            display: none;
        }
        
        .result-title {
            color: #000000;
            font-size: 32px;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #d7c4b8;
            font-weight: 900;
        }
        
        .result-content {
            line-height: 1.7;
            font-size: 16px;
            color: #000000;
        }
        
        .chart-container {
            margin-top: 25px;
            height: 350px;
        }
        
        /* نتائج التقييم */
        .scores-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .score-card {
            background-color: #f5e9dc;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #8B4513;
        }
        
        .score-domain {
            font-weight: 900;
            color: #000000;
            margin-bottom: 5px;
            font-size: 16px;
        }
        
        .score-value {
            font-size: 20px;
            font-weight: 900;
            color: #000000;
        }
        
        /* التذييل */
        footer {
            text-align: center;
            margin-top: 30px;
            padding-top: 15px;
            border-top: 1px solid #d7c4b8;
            color: #000000;
            font-size: 16px;
            font-weight: 900;
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        .footer-author {
            color: #5D4037;
            font-weight: 800;
            font-size: 17px;
            margin-top: 5px;
        }
        
        /* التكيف مع الشاشات الصغيرة */
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            h1 {
                font-size: 32px;
            }
            
            .main-title {
                font-size: 28px;
            }
            
            .timers-section, .info-grid {
                grid-template-columns: 1fr;
            }
            
            .evaluation-table-container {
                font-size: 14px;
            }
            
            .evaluation-table th,
            .evaluation-table td {
                padding: 8px 6px;
            }
            
            .action-buttons {
                grid-template-columns: 1fr;
            }
            
            .action-btn {
                min-width: 100%;
            }
            
            .info-label {
                min-width: 140px;
            }
            
            .domain-header {
                font-size: 24px;
                padding: 12px;
            }
            
            .result-title {
                font-size: 26px;
            }
        }
        
        /* تصميم خاص للطباعة - حجم خط 14px */
        @media print {
            body {
                background-color: white !important;
                color: black !important;
                padding: 0;
                margin: 0;
                font-size: 14px !important; /* حجم الخط الأساسي للطباعة 14px */
            }
            
            .container {
                box-shadow: none !important;
                border: none !important;
                padding: 0 !important;
                margin: 0 !important;
                font-size: 14px !important;
            }
            
            .timers-section, .action-buttons, .record-controls, .btn, #evaluation-table-body .rating-select {
                display: none !important;
            }
            
            .result-section {
                display: block !important;
                border: none !important;
                padding: 0 !important;
                margin-top: 20px !important;
                page-break-inside: avoid;
                font-size: 14px !important;
            }
            
            h1 {
                font-size: 28px !important;
                color: black !important;
            }
            
            .main-title {
                font-size: 22px !important;
                color: black !important;
            }
            
            .result-title {
                color: black !important;
                font-size: 20px !important;
                font-weight: bold !important;
            }
            
            .result-content {
                color: black !important;
                font-size: 14px !important; /* حجم خط محدد 14px */
                line-height: 1.5 !important;
            }
            
            .chart-container {
                height: 300px !important;
                page-break-inside: avoid;
            }
            
            .scores-summary {
                grid-template-columns: repeat(3, 1fr) !important;
                font-size: 14px !important;
            }
            
            .score-card {
                border: 1px solid #ddd !important;
                page-break-inside: avoid;
                font-size: 14px !important;
            }
            
            .score-domain {
                font-size: 14px !important;
            }
            
            .score-value {
                font-size: 16px !important;
            }
            
            footer {
                border-top: 1px solid #000 !important;
                color: black !important;
                margin-top: 20px !important;
                padding-top: 10px !important;
                font-size: 14px !important;
            }
            
            /* حجم خط للرأس عند الطباعة */
            header {
                font-size: 14px !important;
                padding: 15px !important;
            }
            
            /* إظهار تقييم المجالات في الجدول عند الطباعة */
            #evaluation-table-body .domain-header {
                display: table-row !important;
                background-color: #f5e9dc !important;
                color: #00008B !important;
                font-weight: bold !important;
                font-size: 18px !important;
                padding: 12px !important;
            }
            
            #evaluation-table-body .criterion-row {
                display: table-row !important;
            }
            
            #evaluation-table-body .domain-summary {
                display: table-row !important;
                background-color: #e6d5c9 !important;
                font-weight: bold !important;
                font-size: 14px !important;
            }
            
            .evaluation-table {
                min-width: 100% !important;
                font-size: 14px !important;
            }
            
            .evaluation-table th {
                padding: 8px 4px !important;
                font-size: 14px !important;
            }
            
            .evaluation-table td {
                padding: 6px 4px !important;
                font-size: 14px !important;
            }
            
            .criterion-name {
                font-size: 14px !important;
            }
            
            .rating-details {
                font-size: 13px !important;
            }
            
            .domain-score {
                font-size: 16px !important;
            }
            
            /* إظهار قيم التقييم في الجدول عند الطباعة */
            .rating-value-print {
                display: inline-block !important;
                font-weight: bold;
                color: black;
                background-color: #f5f5f5;
                padding: 2px 6px;
                border-radius: 3px;
                border: 1px solid #ccc;
                font-size: 14px !important;
            }
            
            /* إظهار بيانات المعلم والموجه عند الطباعة حتى لو فارغة */
            .info-section {
                display: block !important;
                font-size: 14px !important;
                background-color: #f5e9dc !important;
                border: 1px solid #ddd !important;
                padding: 10px !important;
                margin-bottom: 15px !important;
                page-break-inside: avoid;
            }
            
            .info-grid {
                display: grid !important;
                grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)) !important;
                gap: 8px !important;
                font-size: 14px !important;
            }
            
            .info-item {
                display: flex !important;
                align-items: center !important;
                padding: 5px !important;
                background-color: #ffffff !important;
                border: 1px solid #ddd !important;
                border-radius: 4px !important;
                page-break-inside: avoid;
            }
            
            .info-label {
                font-weight: bold !important;
                color: black !important;
                min-width: 150px !important;
                margin-left: 5px !important;
                font-size: 14px !important;
            }
            
            .info-value {
                flex: 1 !important;
                color: black !important;
                font-size: 14px !important;
            }
            
            /* عرض قيمة الحقل أو "غير محدد" إذا كان فارغًا */
            .info-item::after {
                content: attr(data-value);
                flex: 1;
                color: black;
                font-size: 14px !important;
            }
            
            /* إخفاء حقول الإدخال عند الطباعة وعرض القيم */
            .info-input {
                display: none !important;
            }
            
            /* عرض القيم المخزنة في حقول الإدخال */
            .info-input-print {
                display: inline !important;
                color: black !important;
                font-size: 14px !important;
            }
            
            /* حجم خط لقسم الملاحظات */
            .notes-section {
                font-size: 14px !important;
                display: block !important;
                background-color: #f5e9dc !important;
                border: 1px dashed #ddd !important;
                padding: 10px !important;
                margin-top: 15px !important;
                page-break-inside: avoid;
            }
            
            textarea {
                font-size: 14px !important;
                border: 1px solid #ddd !important;
                background-color: white !important;
                color: black !important;
                min-height: 80px !important;
            }
            
            /* إخفاء العناصر غير المرغوب فيها */
            .no-print {
                display: none !important;
            }
            
            /* حجم خط للفوتير */
            .footer-author {
                font-size: 14px !important;
                color: black !important;
            }
            
            /* طباعة البيانات كجدول */
            .info-grid::before {
                content: "بيانات المعلم والموجه:";
                display: block;
                font-weight: bold;
                font-size: 16px;
                margin-bottom: 10px;
                color: black;
                border-bottom: 1px solid #000;
                padding-bottom: 5px;
            }
            
            /* طباعة جميع البيانات حتى لو فارغة */
            .info-item[data-field="teacher-name"]::after {
                content: attr(data-value) !important;
            }
            
            .info-item[data-field="teacher-qualification"]::after {
                content: attr(data-value) !important;
            }
            
            .info-item[data-field="teacher-specialty"]::after {
                content: attr(data-value) !important;
            }
            
            .info-item[data-field="teacher-experience"]::after {
                content: attr(data-value) !important;
            }
            
            .info-item[data-field="teacher-lessons"]::after {
                content: attr(data-value) !important;
            }
            
            .info-item[data-field="supervisor-name"]::after {
                content: attr(data-value) !important;
            }
            
            .info-item[data-field="supervisor-specialty"]::after {
                content: attr(data-value) !important;
            }
            
            .info-item[data-field="visit-date"]::after {
                content: attr(data-value) !important;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>استمارة الموجه الذكية</h1>
            <div class="main-title">(استمارة تقييم شامل لأداء المعلم)</div>
        </header>
        
        <!-- قسم بيانات المعلم والموجه - تم تقليل الحجم -->
        <section class="info-section" id="teacher-info-section">
            <h2><i class="fas fa-user-graduate"></i> بيانات المعلم والموجه</h2>
            <div class="info-grid">
                <div class="info-item" data-field="teacher-name">
                    <div class="info-label">اسم المعلم:</div>
                    <input type="text" class="info-input" id="teacher-name" placeholder="أدخل اسم المعلم">
                </div>
                <div class="info-item" data-field="teacher-qualification">
                    <div class="info-label">المؤهل وتاريخه:</div>
                    <input type="text" class="info-input" id="teacher-qualification" placeholder="مثال: بكالوريوس تربية 2010">
                </div>
                <div class="info-item" data-field="teacher-specialty">
                    <div class="info-label">تخصص المعلم:</div>
                    <input type="text" class="info-input" id="teacher-specialty" placeholder="مثال: لغة عربية">
                </div>
                <div class="info-item" data-field="teacher-experience">
                    <div class="info-label">مدة الخبرة والحالة الوظيفية:</div>
                    <input type="text" class="info-input" id="teacher-experience" placeholder="مثال: 10 سنوات - معلم أول">
                </div>
                <div class="info-item" data-field="teacher-lessons">
                    <div class="info-label">عدد الحصص:</div>
                    <input type="text" class="info-input" id="teacher-lessons" placeholder="مثال: 24 حصة أسبوعياً">
                </div>
                <div class="info-item" data-field="supervisor-name">
                    <div class="info-label">اسم الموجه الزائر:</div>
                    <input type="text" class="info-input" id="supervisor-name" placeholder="أدخل اسم الموجه">
                </div>
                <div class="info-item" data-field="supervisor-specialty">
                    <div class="info-label">تخصص الموجه:</div>
                    <input type="text" class="info-input" id="supervisor-specialty" placeholder="مثال: تربية خاصة">
                </div>
                <div class="info-item" data-field="visit-date">
                    <div class="info-label">تاريخ الزيارة:</div>
                    <input type="date" class="info-input" id="visit-date" value="">
                </div>
            </div>
        </section>
        
        <!-- قسم المؤقتات -->
        <section class="timers-section no-print">
            <div class="timer-box">
                <div class="timer-title">
                    <i class="fas fa-chalkboard-teacher"></i>
                    زمن تحدث المعلم
                </div>
                <div class="timer-display" id="teacher-time">00:00:00</div>
                <div class="timer-controls">
                    <button class="btn btn-start" id="teacher-start">
                        <i class="fas fa-play"></i> بدء
                    </button>
                    <button class="btn btn-pause" id="teacher-pause">
                        <i class="fas fa-pause"></i> إيقاف
                    </button>
                    <button class="btn btn-reset" id="teacher-reset">
                        <i class="fas fa-redo"></i> إعادة
                    </button>
                </div>
            </div>
            
            <div class="timer-box">
                <div class="timer-title">
                    <i class="fas fa-users"></i>
                    زمن تحدث الطلاب
                </div>
                <div class="timer-display" id="student-time">00:00:00</div>
                <div class="timer-controls">
                    <button class="btn btn-start" id="student-start">
                        <i class="fas fa-play"></i> بدء
                    </button>
                    <button class="btn btn-pause" id="student-pause">
                        <i class="fas fa-pause"></i> إيقاف
                    </button>
                    <button class="btn btn-reset" id="student-reset">
                        <i class="fas fa-redo"></i> إعادة
                    </button>
                </div>
            </div>
            
            <div class="timer-box interaction-indicator">
                <div class="timer-title">
                    <i class="fas fa-chart-line"></i>
                    مؤشر تفاعل الطلاب
                </div>
                <button class="btn btn-calc" id="calc-interaction">
                    <i class="fas fa-calculator"></i> حساب النسبة
                </button>
                <div class="indicator-value" id="interaction-value">0%</div>
                <div class="indicator-bar" id="interaction-bar" style="width: 0%;"></div>
            </div>
        </section>
        
        <!-- قسم التقييم الجدولي المعدل -->
        <section class="evaluation-table-container">
            <table class="evaluation-table">
                <thead>
                    <tr>
                        <th width="100%">المجال والمحور</th>
                    </tr>
                </thead>
                <tbody id="evaluation-table-body">
                    <!-- سيتم ملء الجدول بواسطة JavaScript -->
                </tbody>
            </table>
        </section>
        
        <!-- قسم الملاحظات الإضافية -->
        <section class="notes-section no-print">
            <div class="notes-title">
                <i class="fas fa-sticky-note"></i>
                ملاحظات إضافية / تسجيل صوتي للملاحظة
            </div>
            <p style="color: #000000; margin-bottom: 10px; font-weight: 900;">(هذه الملاحظات لا تحسب ضمن درجات التقييم، فقط تطبع بالتقرير)</p>
            <textarea id="additional-notes" placeholder="اكتب ملاحظاتك الإضافية هنا..."></textarea>
            
            <div class="record-controls">
                <button class="btn btn-record" id="record-btn">
                    <i class="fas fa-microphone"></i> بدء التسجيل
                </button>
                <button class="btn btn-stop" id="stop-btn" disabled>
                    <i class="fas fa-stop"></i> إيقاف التسجيل
                </button>
                <div id="recording-status" style="margin-right: 15px; color: #000000; display: flex; align-items: center;">
                    <i class="fas fa-circle" style="color: #b08968; margin-left: 5px;"></i> غير مسجل
                </div>
            </div>
        </section>
        
        <!-- أزرار الإجراءات -->
        <section class="action-buttons no-print">
            <button class="btn action-btn btn-generate" id="generate-report">
                <i class="fas fa-robot"></i> توليد التقييم الشامل
            </button>
            <button class="btn action-btn btn-feedback" id="generate-feedback">
                <i class="fas fa-comments"></i> توليد التغذية الراجعة
            </button>
            <button class="btn action-btn btn-chart" id="generate-chart">
                <i class="fas fa-chart-bar"></i> توليد الرسم البياني
            </button>
            <button class="btn action-btn btn-share" id="share-form">
                <i class="fas fa-share-alt"></i> مشاركة رابط الاستمارة
            </button>
            <button class="btn action-btn btn-clear" id="clear-data">
                <i class="fas fa-trash"></i> حذف البيانات
            </button>
            <button class="btn action-btn btn-print" id="print-report">
                <i class="fas fa-print"></i> طباعة التقرير الكامل
            </button>
            <button class="btn action-btn btn-save" id="save-report">
                <i class="fas fa-file-export"></i> حفظ ومشاركة التقرير
            </button>
        </section>
        
        <!-- قسم النتائج -->
        <section class="result-section" id="result-section">
            <div class="result-title" id="result-title"></div>
            <div class="result-content" id="result-content"></div>
            
            <div class="scores-summary" id="scores-summary">
                <!-- سيتم ملء ملخص النتائج بواسطة JavaScript -->
            </div>
            
            <div class="chart-container">
                <canvas id="evaluation-chart"></canvas>
            </div>
        </section>
    </div>
    
    <footer>
        2026 الاستمارة الذكية لتقييم أداء المعلم
        <div class="footer-author">إعداد: نجاة شمسان</div>
    </footer>

    <script>
        // بيانات استمارة التقييم الجديدة مع المجالات المحددة
        const evaluationData = [
            {
                id: 1,
                title: "المجال الأول: التخطيط للدرس والإعداد",
                criteria: [
                    {
                        name: "وضوح أهداف التعلم",
                        descriptions: [
                            "ضعيف: غير مفهومة.",
                            "مقبول: عامة وغير قابلة للقياس.",
                            "جيد: واضحة لكنها غير معلنة للطلاب.",
                            "جيد جدا: واضحة وقابلة للقياس ومعلنة للطلاب.",
                            "ممتاز: تراعي مستويات التفكير العليا ومعلنة للطلاب"
                        ]
                    },
                    {
                        name: "مراعاة التنوع والفروق",
                        descriptions: [
                            "ضعيف: لا توجد أي اعتبارات للفروق الفردية.",
                            "مقبول: الخطة تذكر الفروق ولكن دون أنشطة.",
                            "جيد: الخطة تتضمن نشاطاً واحداً يراعي الفروق.",
                            "جيد جدا: تتضمن أنشطة متمايزة تراعي احتياجات فئات مختلفة من الطلاب.",
                            "ممتاز: تعتمد نموذج تمايز شاملاً ابداعياً"
                        ]
                    },
                    {
                        name: "اكتمال الخطة وإجرائيتها",
                        descriptions: [
                            "ضعيف: الخطة ناقصة أو غير عملية.",
                            "مقبول: تحتوي على أجزاء أساسية لكنها غير مفصلة.",
                            "جيد: مكتملة الأركان وواضحة خطوات التنفيذ.",
                            "جيد جدا: مفصلة وواقعية، ومزمنة.",
                            "ممتاز: شاملة ومرنة، تتضمن بدائل وحلولاً طارئة لأي عائق"
                        ]
                    }
                ]
            },
            {
                id: 2,
                title: "المجال الثاني: تنفيذ الدرس",
                criteria: [
                    {
                        name: "التمهيد وإثارة الدافعية",
                        descriptions: [
                            "ضعيف: لا يوجد تمهيد، البدء مفاجئ بالمحتوى.",
                            "مقبول: تمهيد روتيني دون إثارة فضول.",
                            "جيد: تمهيد يربط الدرس الجديد بالسابق.",
                            "جيد جدا: تمهيد جاذب يربط الدرس بحياة الطلاب.",
                            "ممتاز: تمهيد مثير ومحفز يخلق لحاجة ملحة للمعرفة."
                        ]
                    },
                    {
                        name: "تنويع استراتيجيات التدريس",
                        descriptions: [
                            "ضعيف: يعتمد على أسلوب واحد فقط (محاضرة).",
                            "مقبول: يحاول استخدام أسلوب آخر لكن التنفيذ ضعيف.",
                            "جيد: يستخدم أسلوبين مختلفين بشكل مناسب.",
                            "جيد جدا: يستخدم ثلاثة أساليب أو أكثر.",
                            "ممتاز: يستخدم مزيجاً إبداعياً ومتكاملاً من الاستراتيجيات."
                        ]
                    },
                    {
                        name: "توظيف الوسائل والتقنية",
                        descriptions: [
                            "ضعيف: لا يستخدم وسائل أو يستخدمها بشكل عشوائي مشتت.",
                            "مقبول: يستخدم الوسائل بشكل عشوائي.",
                            "جيد: يستخدم وسائل مناسبة وواضحة تدعم الشرح.",
                            "جيد جدا: يستخدم وسائل وتقنيات متنوعة وذات جودة عالية.",
                            "ممتاز: يوظف الوسائل والتقنية بطريقة إبداعية تحولها إلى أدوات للاستقصاء والتفكير."
                        ]
                    },
                    {
                        name: "إدارة الوقت بكفاءة",
                        descriptions: [
                            "ضعيف: الوقت مهدر ولا يكفي لإنهاء الدرس.",
                            "مقبول: الوقت غير منظم، مع إطالة في أجزاء وتقصير في أخرى.",
                            "جيد: ينهي أجزاء الدرس الرئيسية في الوقت المحدد.",
                            "جيد جدا: يوزع الوقت بشكل متوازن ومرن.",
                            "ممتاز: يدير الوقت بإتقان، ويستثمر اللحظات غير المتوقعة."
                        ]
                    }
                ]
            },
            {
                id: 3,
                title: "المجال الثالث: إدارة البيئة التعليمية وإنجاز الأهداف",
                criteria: [
                    {
                        name: "تحفيز مستويات التفكير العليا",
                        descriptions: [
                            "ضعيف: النشاط لا يتطلب سوى التذكر أو التكرار.",
                            "مقبول: يطلب من الطلاب 'التفكير' دون توفير إطار أو مهام محددة.",
                            "جيد: يخصص نشاطاً واحداً يتطلب تطبيقاً أو تحليلاً بسيطاً.",
                            "جيد جدا: يصمم أنشطة مركزة تطلب التحليل أو التقويم أو حل المشكلات.",
                            "ممتاز: يصمم أنشطة تحفز التفكير الناقد والإبداعي."
                        ]
                    },
                    {
                        name: "التوزيع العادل للمشاركة",
                        descriptions: [
                            "ضعيف: المشاركة محصورة في طلاب محددين.",
                            "مقبول: يحاول توزيع المشاركة لكنه يعود لنفس الطلاب.",
                            "جيد: يدعو طلاباً مختلفين للإجابة لكن دون نظام واضح.",
                            "جيد جدا: يستخدم آليات لتوزيع الفرص ويحرص على مشاركة الهادئين.",
                            "ممتاز: يخلق نظاماً صفياً عادلاً وفعالاً."
                        ]
                    },
                    {
                        name: "مشاركة وانخراط الطلاب",
                        descriptions: [
                            "ضعيف: انخراط ضعيف، مع علامات ملل أو تشتت عند الكثيرين.",
                            "مقبول: انخراط سلبي (استماع فقط) من غالبية الطلاب.",
                            "جيد: مشاركة نشطة من مجموعة جيدة من الطلاب.",
                            "جيد جدا: مشاركة نشطة وإيجابية من غالبية الطلاب.",
                            "ممتاز: انخراط كامل وحماسي، حيث يبدي الطلاب فضولاً ذاتياً ويطرحون أسئلة."
                        ]
                    },
                    {
                        name: "تطبيق المعرفة في سياقات جديدة",
                        descriptions: [
                            "ضعيف: لا يستطيع الطلاب تطبيق ما تعلموه خارج السياق المباشر.",
                            "مقبول: يواجه الطلاب صعوبة كبيرة في التطبيق حتى مع توجيه مكثف.",
                            "جيد: يستطيع بعض الطلاب التطبيق في سياقات مشابهة.",
                            "جيد جدا: يستطيع معظم الطلاب تطبيق ما تعلموه في سياقات جديدة.",
                            "ممتاز: يستطيع الطلاب نقل التعلم بشكل مرن وإبداعي."
                        ]
                    }
                ]
            },
            {
                id: 4,
                title: "المجال الرابع: ادارة البيئة الصفية",
                criteria: [
                    {
                        name: "البيئة الصفية",
                        descriptions: [
                            "ضعيف: الفصل غير منظم.",
                            "مقبول: الفصل مرتب ولكن لا يدعم التفاعل.",
                            "جيد: يرتب المقاعد للأنشطة لكن بشكل تقليدي.",
                            "جيد جدا: يرتب المقاعد بشكل مجموعات دائرية يدعم نشاط التعلم.",
                            "ممتاز: يصمم البيئة المادية بشكل مرن وديناميكي، بطريقة محفزة للاستكشاف."
                        ]
                    },
                    {
                        name: "خلق مناخ نفسي إيجابي",
                        descriptions: [
                            "ضعيف: يخلق جواً من التوتر أو السخرية واللامبالاة.",
                            "مقبول: يحاول أن يكون إيجابياً ولكن بشكل غير متسق.",
                            "جيد: يخلق جواً محايداً وآمناً، دون توتر.",
                            "جيد جدا: يظهر احتراماً حقيقياً ودفئاً تجاه الطلاب.",
                            "ممتاز: يبني مجتمعاً صفياً متماسكاً قائماً على الدعم المتبادل."
                        ]
                    }
                ]
            },
            {
                id: 5,
                title: "المجال الخامس: التقويم من أجل التعلم",
                criteria: [
                    {
                        name: "التقويم التكويني (المستمر)",
                        descriptions: [
                            "ضعيف: لا يوجد تقويم أثناء الدرس.",
                            "مقبول: يستخدم تقويماً واحداً (أسئلة شفهية) في نهاية الشرح.",
                            "جيد: يستخدم أسلوبين تقويمي (شفهي، كتابي سريع).",
                            "جيد جدا: يستخدم تقويماً تكوينياً سريعاً ومتنوعاً.",
                            "ممتاز: يجعل التقويم التكويني جزءاً لا ينفصل عن التدريس."
                        ]
                    },
                    {
                        name: "الاستجابة الفورية لنتائج التقويم",
                        descriptions: [
                            "ضعيف: يتجاهل علامات عدم الفهم ويواصل شرحه.",
                            "مقبول: يلاحظ عدم الفهم لكن تدخله غير فعال (يكرر الشرح نفسه).",
                            "جيد: يعيد شرح النقطة التي أظهر الطلاب صعوبة فيها.",
                            "جيد جدا: يعدل استراتيجيته أو يقدم تدخلاً فورياً بناءً على نتيجة التقويم.",
                            "ممتاز: يستخدم بيانات التقويم التكويني لتمايز التدريس فورياً."
                        ]
                    },
                    {
                        name: "تنويع أدوات التقويم الختامي",
                        descriptions: [
                            "ضعيف: يعتمد على اختبار تقليدي فقط في نهاية الوحدة.",
                            "مقبول: يستخدم أداة ختامية واحدة غير مرتبطة بجميع الأهداف.",
                            "جيد: يستخدم أداتين مختلفتين للتقويم الختامي.",
                            "جيد جدا: يستخدم أدوات تقويم ختامية متنوعة لقياس جوانب مختلفة.",
                            "ممتاز: يصمم تقويماً ختامياً يعكس تطبيق المعرفة في سياقات ذات معنى للطلاب."
                        ]
                    },
                    {
                        name: "ربط التقويم بالأهداف",
                        descriptions: [
                            "ضعيف: لا يوجد ارتباط بين ما تم تقييمه والأهداف.",
                            "مقبول: الارتباط موجود لكنه غير واضح للطلاب.",
                            "جيد: أسئلة التقويم تغطي معظم الأهداف.",
                            "جيد جدا: تحقق مهام التقويم انعكاساً واضحاً ودقيقاً للأهداف.",
                            "ممتاز: يشرك الطلاب في تصميم معايير التقويم بناءً على الأهداف."
                        ]
                    }
                ]
            },
            {
                id: 6,
                title: "المجال السادس: السمات الشخصية والمهنية",
                criteria: [
                    {
                        name: "المظهر العام والهيئة",
                        descriptions: [
                            "ضعيف: مظهر غير لائق أو غير نظيف.",
                            "مقبول: مظهر عادي ولكن به بعض التقصير.",
                            "جيد: مظهر لائق ونظيف ومناسب للمهنة.",
                            "جيد جدا: مظهر وقور، ويعكس الجدية.",
                            "ممتاز: مظهر يضفي هيبة واحتراماً تلقائياً."
                        ]
                    },
                    {
                        name: "أخلاقيات المهنة",
                        descriptions: [
                            "ضعيف: سلوكيات غير أخلاقية (تحيز، إفشاء أسرار، عدم احترام).",
                            "مقبول: يظهر بعض التحيز أو عدم الإنصاف أحياناً.",
                            "جيد: يتعامل بأخلاقيات مهنية مقبولة دون تمييز.",
                            "جيد جدا: يتسم بالنزاهة والعدل والشفافية.",
                            "ممتاز: يمثل قدوة أخلاقية عالية، ويبني ثقافة المسؤولية."
                        ]
                    },
                    {
                        name: "التطوير الذاتي",
                        descriptions: [
                            "ضعيف: مقاوم للتغيير ولا يبذل جهداً للتطوير.",
                            "مقبول: يشارك في التدريب الإلزامي فقط دون تطبيق فعلي.",
                            "جيد: يبحث عن بعض المصادر أو التدريبات لتطوير أدائه.",
                            "جيد جدا: يتابع أحدث المستجدات التربوية وينفذها.",
                            "ممتاز: قائد في التطوير المهني، ويساهم في تدريب زملائه."
                        ]
                    }
                ]
            }
        ];

        // متغيرات المؤقتات
        let teacherTimer = { seconds: 0, interval: null, running: false };
        let studentTimer = { seconds: 0, interval: null, running: false };
        
        // بيانات التقييم
        let evaluationResults = {};
        
        // حالة التسجيل الصوتي
        let isRecording = false;
        
        // تهيئة الصفحة
        document.addEventListener('DOMContentLoaded', function() {
            // تعيين تاريخ اليوم كقيمة افتراضية
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('visit-date').value = today;
            
            // توليد جدول التقييم
            generateEvaluationTable();
            
            // إضافة معالجي الأحداث للمؤقتات
            initTimers();
            
            // إضافة معالجي الأحداث للأزرار
            initButtons();
            
            // تهيئة بيانات التقييم
            initEvaluationData();
        });
        
        // توليد جدول التقييم المعدل
        function generateEvaluationTable() {
            const tableBody = document.getElementById('evaluation-table-body');
            
            evaluationData.forEach(domain => {
                // صف المجال
                const domainRow = document.createElement('tr');
                domainRow.className = 'domain-header';
                domainRow.innerHTML = `
                    <td><i class="fas fa-folder-open" style="margin-left: 10px;"></i> ${domain.title}</td>
                `;
                tableBody.appendChild(domainRow);
                
                // صفوف المعايير
                domain.criteria.forEach((criterion, index) => {
                    const criterionRow = document.createElement('tr');
                    criterionRow.className = 'criterion-row';
                    criterionRow.id = `domain-${domain.id}-criterion-${index}`;
                    
                    criterionRow.innerHTML = `
                        <td>
                            <div class="criterion-name"><i class="fas fa-circle" style="font-size: 8px; color: #5D4037; margin-left: 10px;"></i> ${criterion.name}</div>
                            <div class="rating-cell">
                                <select class="rating-select rating-1" data-domain="${domain.id}" data-criterion="${index}">
                                    <option value="0" selected>-- اختر مستوى التقييم --</option>
                                    <option value="1">1 - ضعيف</option>
                                    <option value="2">2 - مقبول</option>
                                    <option value="3">3 - جيد</option>
                                    <option value="4">4 - جيد جداً</option>
                                    <option value="5">5 - ممتاز</option>
                                </select>
                                <div class="rating-details" id="details-domain-${domain.id}-criterion-${index}"></div>
                            </div>
                        </td>
                    `;
                    
                    tableBody.appendChild(criterionRow);
                    
                    // إضافة معالج الحدث لقائمة التقييم
                    const selectElement = criterionRow.querySelector('.rating-select');
                    const detailsElement = document.getElementById(`details-domain-${domain.id}-criterion-${index}`);
                    
                    selectElement.addEventListener('change', function() {
                        const value = parseInt(this.value);
                        const domainId = this.getAttribute('data-domain');
                        const criterionIndex = this.getAttribute('data-criterion');
                        
                        // تحديث فئة التحديد
                        this.className = `rating-select rating-${value}`;
                        
                        // عرض تفاصيل التقييم
                        if (value > 0) {
                            detailsElement.innerHTML = `<strong>التفاصيل:</strong> ${criterion.descriptions[value-1]}`;
                            detailsElement.classList.add('show');
                            
                            // حفظ التقييم
                            if (!evaluationResults[domainId]) evaluationResults[domainId] = {};
                            evaluationResults[domainId][criterionIndex] = value;
                        } else {
                            detailsElement.classList.remove('show');
                            if (evaluationResults[domainId]) {
                                delete evaluationResults[domainId][criterionIndex];
                            }
                        }
                        
                        // تحديث ملخص المجال
                        updateDomainSummary(domainId);
                    });
                    
                    // إضافة معالج حدث لعرض التفاصيل عند التمرير
                    selectElement.addEventListener('focus', function() {
                        const domainId = this.getAttribute('data-domain');
                        const criterionIndex = this.getAttribute('data-criterion');
                        const criterion = evaluationData[domainId-1].criteria[criterionIndex];
                        
                        // عرض جميع الخيارات عند التركيز
                        let detailsHTML = "<strong>مستويات التقييم:</strong><ul style='margin-top:5px; padding-right:15px;'>";
                        criterion.descriptions.forEach((desc, i) => {
                            detailsHTML += `<li><strong>${i+1}:</strong> ${desc}</li>`;
                        });
                        detailsHTML += "</ul>";
                        
                        detailsElement.innerHTML = detailsHTML;
                        detailsElement.classList.add('show');
                    });
                    
                    // إخفاء التفاصيل عند فقدان التركيز إذا لم يكن هناك اختيار
                    selectElement.addEventListener('blur', function() {
                        setTimeout(() => {
                            if (this.value === "0") {
                                detailsElement.classList.remove('show');
                            }
                        }, 200);
                    });
                });
                
                // صف ملخص المجال
                const summaryRow = document.createElement('tr');
                summaryRow.className = 'domain-summary';
                summaryRow.id = `domain-summary-${domain.id}`;
                summaryRow.innerHTML = `
                    <td><span class="domain-score" id="domain-score-${domain.id}">0%</span> نسبة التقييم للمجال</td>
                `;
                tableBody.appendChild(summaryRow);
            });
        }
        
        // تحديث ملخص المجال
        function updateDomainSummary(domainId) {
            const domain = evaluationData.find(d => d.id == domainId);
            if (!domain) return;
            
            let totalScore = 0;
            let totalCriteria = 0;
            
            domain.criteria.forEach((criterion, index) => {
                totalCriteria++;
                if (evaluationResults[domainId] && evaluationResults[domainId][index]) {
                    totalScore += evaluationResults[domainId][index];
                }
            });
            
            let percentage = 0;
            if (totalCriteria > 0) {
                percentage = Math.round((totalScore / (totalCriteria * 5)) * 100);
            }
            
            const scoreElement = document.getElementById(`domain-score-${domainId}`);
            scoreElement.textContent = `${percentage}%`;
            
            // تحديث لون النسبة بناءً على القيمة
            if (percentage >= 90) {
                scoreElement.style.color = "#388e3c";
            } else if (percentage >= 80) {
                scoreElement.style.color = "#689f38";
            } else if (percentage >= 70) {
                scoreElement.style.color = "#ffb300";
            } else if (percentage >= 60) {
                scoreElement.style.color = "#f57c00";
            } else {
                scoreElement.style.color = "#d32f2f";
            }
        }
        
        // تهيئة المؤقتات
        function initTimers() {
            // مؤقت المعلم
            document.getElementById('teacher-start').addEventListener('click', () => startTimer('teacher'));
            document.getElementById('teacher-pause').addEventListener('click', () => pauseTimer('teacher'));
            document.getElementById('teacher-reset').addEventListener('click', () => resetTimer('teacher'));
            
            // مؤقت الطلاب
            document.getElementById('student-start').addEventListener('click', () => startTimer('student'));
            document.getElementById('student-pause').addEventListener('click', () => pauseTimer('student'));
            document.getElementById('student-reset').addEventListener('click', () => resetTimer('student'));
            
            // زر حساب مؤشر التفاعل
            document.getElementById('calc-interaction').addEventListener('click', calculateInteraction);
        }
        
        // تهيئة بيانات التقييم
        function initEvaluationData() {
            // تهيئة كائن النتائج
            evaluationData.forEach(domain => {
                evaluationResults[domain.id] = {};
            });
        }
        
        // تهيئة الأزرار
        function initButtons() {
            // زر توليد التقرير
            document.getElementById('generate-report').addEventListener('click', generateReport);
            
            // زر توليد التغذية الراجعة
            document.getElementById('generate-feedback').addEventListener('click', generateFeedback);
            
            // زر توليد الرسم البياني
            document.getElementById('generate-chart').addEventListener('click', generateChart);
            
            // زر مشاركة رابط الاستمارة
            document.getElementById('share-form').addEventListener('click', shareForm);
            
            // زر حذف البيانات
            document.getElementById('clear-data').addEventListener('click', clearAllData);
            
            // زر حفظ التقرير
            document.getElementById('save-report').addEventListener('click', saveReport);
            
            // زر طباعة التقرير
            document.getElementById('print-report').addEventListener('click', printReport);
            
            // أزرار التسجيل الصوتي
            document.getElementById('record-btn').addEventListener('click', startRecording);
            document.getElementById('stop-btn').addEventListener('click', stopRecording);
        }
        
        // دالة حذف جميع البيانات
        function clearAllData() {
            if (confirm("هل أنت متأكد من حذف جميع البيانات؟ سيتم حذف جميع المعلومات والتقييمات السابقة.")) {
                // مسح حقول بيانات المعلم والموجه
                document.getElementById('teacher-name').value = '';
                document.getElementById('teacher-qualification').value = '';
                document.getElementById('teacher-specialty').value = '';
                document.getElementById('teacher-experience').value = '';
                document.getElementById('teacher-lessons').value = '';
                document.getElementById('supervisor-name').value = '';
                document.getElementById('supervisor-specialty').value = '';
                document.getElementById('visit-date').value = new Date().toISOString().split('T')[0];
                
                // إعادة تعيين المؤقتات
                resetTimer('teacher');
                resetTimer('student');
                
                // مسح مؤشر التفاعل
                document.getElementById('interaction-value').textContent = '0%';
                document.getElementById('interaction-bar').style.width = '0%';
                
                // مسح جميع اختيارات التقييم في الجدول
                const selectElements = document.querySelectorAll('.rating-select');
                selectElements.forEach(select => {
                    select.value = '0';
                    select.className = 'rating-select rating-1';
                    
                    // إخفاء تفاصيل التقييم
                    const domainId = select.getAttribute('data-domain');
                    const criterionIndex = select.getAttribute('data-criterion');
                    const detailsElement = document.getElementById(`details-domain-${domainId}-criterion-${criterionIndex}`);
                    if (detailsElement) {
                        detailsElement.classList.remove('show');
                    }
                });
                
                // إعادة تعيين ملخصات المجالات
                evaluationData.forEach(domain => {
                    const scoreElement = document.getElementById(`domain-score-${domain.id}`);
                    scoreElement.textContent = '0%';
                    scoreElement.style.color = '#d32f2f';
                });
                
                // مسح بيانات التقييم المخزنة
                evaluationResults = {};
                initEvaluationData();
                
                // مسح الملاحظات الإضافية
                document.getElementById('additional-notes').value = '';
                
                // إخفاء قسم النتائج إذا كان ظاهراً
                document.getElementById('result-section').style.display = 'none';
                
                // إعادة تعيين حالة التسجيل الصوتي
                if (isRecording) {
                    stopRecording();
                }
                
                // إعادة تعيين حالة مؤشر التسجيل
                document.getElementById('record-btn').classList.remove('recording');
                document.getElementById('record-btn').disabled = false;
                document.getElementById('stop-btn').disabled = true;
                document.getElementById('recording-status').innerHTML = '<i class="fas fa-circle" style="color: #b08968; margin-left: 5px;"></i> غير مسجل';
                document.getElementById('recording-status').style.color = '#000000';
                
                alert("تم حذف جميع البيانات بنجاح. يمكنك الآن البدء في تقييم جديد.");
            }
        }
        
        // دوال المؤقتات
        function startTimer(timerType) {
            const timer = timerType === 'teacher' ? teacherTimer : studentTimer;
            
            if (!timer.running) {
                timer.running = true;
                timer.interval = setInterval(() => {
                    timer.seconds++;
                    updateTimerDisplay(timerType);
                }, 1000);
                
                // تحديث حالة الأزرار
                const startBtn = document.getElementById(`${timerType}-start`);
                const pauseBtn = document.getElementById(`${timerType}-pause`);
                
                startBtn.disabled = true;
                pauseBtn.disabled = false;
            }
        }
        
        function pauseTimer(timerType) {
            const timer = timerType === 'teacher' ? teacherTimer : studentTimer;
            
            if (timer.running) {
                timer.running = false;
                clearInterval(timer.interval);
                
                // تحديث حالة الأزرار
                const startBtn = document.getElementById(`${timerType}-start`);
                const pauseBtn = document.getElementById(`${timerType}-pause`);
                
                startBtn.disabled = false;
                pauseBtn.disabled = true;
            }
        }
        
        function resetTimer(timerType) {
            const timer = timerType === 'teacher' ? teacherTimer : studentTimer;
            
            timer.running = false;
            clearInterval(timer.interval);
            timer.seconds = 0;
            updateTimerDisplay(timerType);
            
            // تحديث حالة الأزرار
            const startBtn = document.getElementById(`${timerType}-start`);
                const pauseBtn = document.getElementById(`${timerType}-pause`);
                
                startBtn.disabled = false;
                pauseBtn.disabled = true;
        }
        
        function updateTimerDisplay(timerType) {
            const timer = timerType === 'teacher' ? teacherTimer : studentTimer;
            const display = document.getElementById(`${timerType}-time`);
            
            const hours = Math.floor(timer.seconds / 3600);
            const minutes = Math.floor((timer.seconds % 3600) / 60);
            const seconds = timer.seconds % 60;
            
            display.textContent = 
                `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }
        
        // حساب مؤشر التفاعل
        function calculateInteraction() {
            const totalTime = teacherTimer.seconds + studentTimer.seconds;
            
            if (totalTime === 0) {
                alert("يرجى تشغيل مؤقت المعلم والطلاب أولاً");
                return;
            }
            
            const interactionPercent = Math.round((studentTimer.seconds / totalTime) * 100);
            document.getElementById('interaction-value').textContent = `${interactionPercent}%`;
            document.getElementById('interaction-bar').style.width = `${interactionPercent}%`;
            
            // تلوين المؤشر حسب النسبة
            const indicatorBar = document.getElementById('interaction-bar');
            if (interactionPercent < 30) {
                indicatorBar.style.background = "linear-gradient(to right, #d32f2f, #f57c00)";
            } else if (interactionPercent < 50) {
                indicatorBar.style.background = "linear-gradient(to right, #ffb300, #f57c00)";
            } else {
                indicatorBar.style.background = "linear-gradient(to right, #689f38, #388e3c)";
            }
        }
        
        // مشاركة رابط الاستمارة
        function shareForm() {
            const currentUrl = window.location.href;
            
            if (navigator.share) {
                navigator.share({
                    title: 'استمارة الموجه الذكية',
                    text: 'استمارة تقييم شامل لأداء المعلم - إعداد نجاة شمسان',
                    url: currentUrl
                })
                .then(() => console.log('تم المشاركة بنجاح'))
                .catch((error) => {
                    console.error('حدث خطأ أثناء المشاركة:', error);
                    copyToClipboard(currentUrl);
                });
            } else {
                copyToClipboard(currentUrl);
            }
        }
        
        // نسخ النص إلى الحافظة
        function copyToClipboard(text) {
            navigator.clipboard.writeText(text)
                .then(() => {
                    alert('تم نسخ رابط الاستمارة إلى الحافظة:\n\n' + text + '\n\nيمكنك الآن مشاركته مع الآخرين');
                })
                .catch(err => {
                    console.error('فشل نسخ النص: ', err);
                    // طريقة بديلة للمتصفحات القديمة
                    const textArea = document.createElement('textarea');
                    textArea.value = text;
                    document.body.appendChild(textArea);
                    textArea.select();
                    document.execCommand('copy');
                    document.body.removeChild(textArea);
                    alert('تم نسخ رابط الاستمارة إلى الحافظة:\n\n' + text + '\n\nيمكنك الآن مشاركته مع الآخرين');
                });
        }
        
        // التسجيل الصوتي
        function startRecording() {
            if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
                navigator.mediaDevices.getUserMedia({ audio: true })
                    .then(stream => {
                        isRecording = true;
                        
                        // تحديث واجهة المستخدم
                        document.getElementById('record-btn').classList.add('recording');
                        document.getElementById('record-btn').disabled = true;
                        document.getElementById('stop-btn').disabled = false;
                        
                        const statusElement = document.getElementById('recording-status');
                        statusElement.innerHTML = '<i class="fas fa-circle" style="color: #d32f2f; margin-left: 5px;"></i> جاري التسجيل...';
                        statusElement.style.color = '#d32f2f';
                        
                        // في تطبيق حقيقي، هنا سيتم بدء التسجيل الفعلي
                        console.log("بدء التسجيل الصوتي");
                    })
                    .catch(err => {
                        console.error("خطأ في الوصول إلى الميكروفون:", err);
                        alert("تعذر الوصول إلى الميكروفون. يرجى التحقق من الأذونات.\n\nملاحظة: في هذا النموذج التوضيحي، يتم محاكاة التسجيل فقط.");
                        
                        // محاكاة التسجيل للعرض التوضيحي
                        isRecording = true;
                        document.getElementById('record-btn').classList.add('recording');
                        document.getElementById('record-btn').disabled = true;
                        document.getElementById('stop-btn').disabled = false;
                        
                        const statusElement = document.getElementById('recording-status');
                        statusElement.innerHTML = '<i class="fas fa-circle" style="color: #d32f2f; margin-left: 5px;"></i> جاري التسجيل (محاكاة)...';
                        statusElement.style.color = '#d32f2f';
                    });
            } else {
                alert("متصفحك لا يدعم التسجيل الصوتي. يرجى استخدام متصفح حديث.\n\nملاحظة: في هذا النموذج التوضيحي، يتم محاكاة التسجيل فقط.");
                
                // محاكاة التسجيل للعرض التوضيحي
                isRecording = true;
                document.getElementById('record-btn').classList.add('recording');
                document.getElementById('record-btn').disabled = true;
                document.getElementById('stop-btn').disabled = false;
                
                const statusElement = document.getElementById('recording-status');
                statusElement.innerHTML = '<i class="fas fa-circle" style="color: #d32f2f; margin-left: 5px;"></i> جاري التسجيل (محاكاة)...';
                statusElement.style.color = '#d32f2f';
            }
        }
        
        function stopRecording() {
            if (isRecording) {
                isRecording = false;
                
                // تحديث واجهة المستخدم
                document.getElementById('record-btn').classList.remove('recording');
                document.getElementById('record-btn').disabled = false;
                document.getElementById('stop-btn').disabled = true;
                
                const statusElement = document.getElementById('recording-status');
                statusElement.innerHTML = '<i class="fas fa-check-circle" style="color: #388e3c; margin-left: 5px;"></i> تم التسجيل بنجاح';
                statusElement.style.color = '#388e3c';
                
                console.log("إيقاف التسجيل الصوتي");
            }
        }
        
        // توليد التقرير مع بيانات المعلم
        function generateReport() {
            // جمع بيانات المعلم
            const teacherData = {
                name: document.getElementById('teacher-name').value || "غير محدد",
                qualification: document.getElementById('teacher-qualification').value || "غير محدد",
                specialty: document.getElementById('teacher-specialty').value || "غير محدد",
                experience: document.getElementById('teacher-experience').value || "غير محدد",
                lessons: document.getElementById('teacher-lessons').value || "غير محدد",
                supervisor: document.getElementById('supervisor-name').value || "غير محدد",
                supervisorSpecialty: document.getElementById('supervisor-specialty').value || "غير محدد",
                visitDate: document.getElementById('visit-date').value || "غير محدد"
            };
            
            // التحقق من اكتمال التقييم
            let isComplete = true;
            let incompleteFields = [];
            let totalScore = 0;
            let maxScore = 0;
            let domainAverages = {};
            let domainScores = {};
            
            evaluationData.forEach(domain => {
                let domainTotal = 0;
                let domainCriteriaCount = 0;
                
                domain.criteria.forEach((criterion, index) => {
                    maxScore += 5;
                    if (evaluationResults[domain.id] && evaluationResults[domain.id][index]) {
                        domainTotal += evaluationResults[domain.id][index];
                        totalScore += evaluationResults[domain.id][index];
                        domainCriteriaCount++;
                    } else {
                        isComplete = false;
                        incompleteFields.push(`${domain.title.split(':')[1]} - ${criterion.name}`);
                    }
                });
                
                if (domainCriteriaCount > 0) {
                    domainAverages[domain.id] = (domainTotal / domain.criteria.length).toFixed(2);
                    domainScores[domain.id] = { total: domainTotal, count: domain.criteria.length };
                } else {
                    domainAverages[domain.id] = 0;
                    domainScores[domain.id] = { total: 0, count: domain.criteria.length };
                }
            });
            
            if (!isComplete) {
                let message = "يرجى إكمال تقييم جميع المحاور قبل توليد التقرير\n\nالمحاور غير المكتملة:\n";
                incompleteFields.forEach((field, index) => {
                    message += `${index + 1}. ${field}\n`;
                });
                alert(message);
                return;
            }
            
            // حساب النتيجة الإجمالية
            const overallPercentage = Math.round((totalScore / maxScore) * 100);
            let overallRating = "";
            
            if (overallPercentage >= 90) overallRating = "متميز";
            else if (overallPercentage >= 80) overallRating = "جيد جداً";
            else if (overallPercentage >= 70) overallRating = "جيد";
            else if (overallPercentage >= 60) overallRating = "مقبول";
            else overallRating = "بحاجة إلى تحسين";
            
            // تحويل تاريخ الزيارة إلى تنسيق عربي
            const visitDate = teacherData.visitDate !== "غير محدد" 
                ? new Date(teacherData.visitDate).toLocaleDateString('ar-EG')
                : "غير محدد";
            
            // توليد نص التقرير
            const reportTitle = "التقرير الشامل لتقييم أداء المعلم";
            const reportContent = `
                <div style="background-color: #f5e9dc; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                    <h3 style="color: #000000; margin-bottom: 10px;">بيانات المعلم والموجه:</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 10px;">
                        <div><strong>اسم المعلم:</strong> ${teacherData.name}</div>
                        <div><strong>المؤهل وتاريخه:</strong> ${teacherData.qualification}</div>
                        <div><strong>تخصص المعلم:</strong> ${teacherData.specialty}</div>
                        <div><strong>مدة الخبرة والحالة الوظيفية:</strong> ${teacherData.experience}</div>
                        <div><strong>عدد الحصص:</strong> ${teacherData.lessons}</div>
                        <div><strong>اسم الموجه الزائر:</strong> ${teacherData.supervisor}</div>
                        <div><strong>تخصص الموجه:</strong> ${teacherData.supervisorSpecialty}</div>
                        <div><strong>تاريخ الزيارة:</strong> ${visitDate}</div>
                    </div>
                </div>
                
                <h3 style="color: #000000;">النتيجة الإجمالية: ${overallPercentage}% - ${overallRating}</h3>
                <p>تم إجراء التقييم في تاريخ ${new Date().toLocaleDateString('ar-EG')}، وشمل ${evaluationData.length} مجالات رئيسية و${maxScore/5} معياراً فرعياً.</p>
                
                <h4 style="margin-top: 20px; color: #000000;">ملخص النتائج لكل مجال:</h4>
                <div class="scores-summary" id="dynamic-scores">
                    ${evaluationData.map(domain => `
                        <div class="score-card">
                            <div class="score-domain">${domain.title.split(':')[1]}</div>
                            <div class="score-value">${domainAverages[domain.id]} / 5 (${Math.round(domainAverages[domain.id] / 5 * 100)}%)</div>
                            <div style="font-size: 14px; color: #5D4037; margin-top: 5px;">${domainScores[domain.id].total} نقطة من ${domainScores[domain.id].count * 5}</div>
                        </div>
                    `).join('')}
                </div>
                
                <h4 style="margin-top: 20px; color: #000000;">الوقت التفاعلي:</h4>
                <p>بلغ زمن تحدث المعلم ${formatTime(teacherTimer.seconds)} وزمن تحدث الطلاب ${formatTime(studentTimer.seconds)}، بمؤشر تفاعل ${document.getElementById('interaction-value').textContent}.</p>
                
                <h4 style="margin-top: 20px; color: #000000;">الملاحظات الإضافية:</h4>
                <p style="background-color: #f5e9dc; padding: 10px; border-radius: 5px;">${document.getElementById('additional-notes').value || "لا توجد ملاحظات إضافية"}</p>
                
                <p style="margin-top: 20px; font-style: italic; color: #5D4037;">تم توليد هذا التقرير تلقائياً بناءً على معايير تقييم أداء المعلم. يوصى بمناقشة النتائج مع المعلم وتقديم الدعم اللازم في المجالات التي تحتاج إلى تحسين.</p>
            `;
            
            // عرض التقرير
            document.getElementById('result-title').innerHTML = reportTitle;
            document.getElementById('result-content').innerHTML = reportContent;
            document.getElementById('result-section').style.display = 'block';
            
            // تحديث ملخص النتائج
            document.getElementById('dynamic-scores').innerHTML = evaluationData.map(domain => `
                <div class="score-card">
                    <div class="score-domain">${domain.title.split(':')[1]}</div>
                    <div class="score-value">${domainAverages[domain.id]} / 5 (${Math.round(domainAverages[domain.id] / 5 * 100)}%)</div>
                    <div style="font-size: 14px; color: #5D4037; margin-top: 5px;">${domainScores[domain.id].total} نقطة من ${domainScores[domain.id].count * 5}</div>
                </div>
            `).join('');
            
            // التمرير إلى قسم النتائج
            document.getElementById('result-section').scrollIntoView({ behavior: 'smooth' });
        }
        
        // توليد التغذية الراجعة
        function generateFeedback() {
            // التحقق من اكتمال التقييم
            let isComplete = true;
            let totalScore = 0;
            let maxScore = 0;
            let domainAverages = {};
            
            evaluationData.forEach(domain => {
                let domainTotal = 0;
                
                domain.criteria.forEach((criterion, index) => {
                    maxScore += 5;
                    if (evaluationResults[domain.id] && evaluationResults[domain.id][index]) {
                        domainTotal += evaluationResults[domain.id][index];
                        totalScore += evaluationResults[domain.id][index];
                    } else {
                        isComplete = false;
                    }
                });
                
                domainAverages[domain.id] = domainTotal > 0 ? (domainTotal / domain.criteria.length).toFixed(2) : 0;
            });
            
            if (!isComplete) {
                alert("يرجى إكمال تقييم جميع المحاور قبل توليد التغذية الراجعة");
                return;
            }
            
            // تحديد أفضل مجال وأضعف مجال
            let bestDomain = {id: 1, avg: 0, name: ""};
            let worstDomain = {id: 1, avg: 5, name: ""};
            
            for (const [id, avg] of Object.entries(domainAverages)) {
                const domainName = evaluationData.find(d => d.id == id).title.split(':')[1];
                if (parseFloat(avg) > bestDomain.avg) {
                    bestDomain = {id: parseInt(id), avg: parseFloat(avg), name: domainName};
                }
                if (parseFloat(avg) < worstDomain.avg) {
                    worstDomain = {id: parseInt(id), avg: parseFloat(avg), name: domainName};
                }
            }
            
            // توليد التغذية الراجعة
            const feedbackTitle = "نقاط القوة والتوصيات والتغذية الراجعة";
            const feedbackContent = `
                <h3 style="color: #000000;">تحليل نتائج التقييم:</h3>
                
                <h4 style="margin-top: 15px; color: #388e3c;">نقاط القوة:</h4>
                <p>بناءً على نتائج التقييم، يظهر المعلم نقاط قوة واضحة في:</p>
                <ul>
                    <li>تميز في <strong>${bestDomain.name}</strong> بمتوسط ${bestDomain.avg} من 5</li>
                    <li>كفاءة في <strong>${getSecondStrongestDomain(domainAverages)}</strong></li>
                    <li>التزام واضح بأخلاقيات المهنة والمظهر العام</li>
                </ul>
                
                <h4 style="margin-top: 15px; color: #d32f2f;">مجالات التحسين:</h4>
                <p>يحتاج المعلم إلى تحسين أدائه في المجالات التالية:</p>
                <ul>
                    <li>تحسين <strong>${worstDomain.name}</strong> حيث بلغ متوسط تقييمه ${worstDomain.avg} من 5</li>
                    <li>تطوير مهارات في <strong>${getSecondWeakestDomain(domainAverages)}</strong></li>
                </ul>
                
                <h4 style="margin-top: 20px; color: #000000;">التوصيات والتغذية الراجعة:</h4>
                <ol>
                    <li><strong>توصية 1:</strong> ${getRecommendation(1, worstDomain.id)}</li>
                    <li><strong>توصية 2:</strong> ${getRecommendation(2, worstDomain.id)}</li>
                    <li><strong>توصية 3:</strong> ${getRecommendation(3, worstDomain.id)}</li>
                    <li><strong>توصية 4:</strong> ${getRecommendation(4, worstDomain.id)}</li>
                </ol>
                
                <h4 style="margin-top: 20px; color: #000000;">خطة التطوير المهني المقترحة:</h4>
                <ul>
                    <li><strong>الزيارات الصفية:</strong> زيارة أسبوعية لمدة شهر لملاحظة التطور في ${worstDomain.name}</li>
                    <li><strong>التدريب:</strong> المشاركة في ورشة عمل حول ${getTrainingTopic(worstDomain.id)}</li>
                    <li><strong>المتابعة:</strong> مقابلة أسبوعية مع الموجه التربوي لمناقشة التقدم</li>
                    <li><strong>الموارد:</strong> توفير ${getResources(worstDomain.id)} للمعلم</li>
                </ul>
                
                <h4 style="margin-top: 20px; color: #000000;">التوقيت المقترح:</h4>
                <p>ينصح بمراجعة أداء المعلم بعد 6 أسابيع من تاريخ التقييم الحالي للاطلاع على التطور في المجالات التي تحتاج إلى تحسين.</p>
                
                <div style="margin-top: 20px; padding: 15px; background-color: #f5e9dc; border-radius: 8px; border-right: 4px solid #8B4513;">
                    <p style="font-style: italic; color: #5D4037;"><strong>ملاحظة:</strong> هذا التقرير تم توليده آلياً بناءً على معايير التقييم. يوصى بمناقشة النتائج مع المعلم وتقديم الدعم المناسب.</p>
                </div>
            `;
            
            // عرض التغذية الراجعة
            document.getElementById('result-title').innerHTML = feedbackTitle;
            document.getElementById('result-content').innerHTML = feedbackContent;
            document.getElementById('result-section').style.display = 'block';
            
            // التمرير إلى قسم النتائج
            document.getElementById('result-section').scrollIntoView({ behavior: 'smooth' });
        }
        
        // توليد الرسم البياني
        function generateChart() {
            // التحقق من اكتمال التقييم
            let isComplete = true;
            
            evaluationData.forEach(domain => {
                domain.criteria.forEach((_, index) => {
                    if (!evaluationResults[domain.id] || !evaluationResults[domain.id][index]) {
                        isComplete = false;
                    }
                });
            });
            
            if (!isComplete) {
                alert("يرجى إكمال تقييم جميع المحاور قبل توليد الرسم البياني");
                return;
            }
            
            // حساب متوسطات المجالات
            let domainLabels = [];
            let domainAverages = [];
            let domainColors = [];
            
            evaluationData.forEach(domain => {
                let domainTotal = 0;
                domain.criteria.forEach((_, index) => {
                    domainTotal += evaluationResults[domain.id][index];
                });
                
                const avg = (domainTotal / domain.criteria.length).toFixed(2);
                domainLabels.push(domain.title.split(':')[1]);
                domainAverages.push(parseFloat(avg));
                
                // تحديد اللون حسب المتوسط
                if (avg >= 4) domainColors.push('#388e3c');
                else if (avg >= 3) domainColors.push('#ffb300');
                else domainColors.push('#d32f2f');
            });
            
            // إنشاء الرسم البياني
            const ctx = document.getElementById('evaluation-chart').getContext('2d');
            
            // إذا كان هناك رسم بياني موجود، قم بتدميره أولاً
            if (window.evaluationChart) {
                window.evaluationChart.destroy();
            }
            
            window.evaluationChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: domainLabels,
                    datasets: [{
                        label: 'متوسط التقييم (من 5)',
                        data: domainAverages,
                        backgroundColor: domainColors,
                        borderColor: domainColors.map(color => color),
                        borderWidth: 1,
                        borderRadius: 5
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 5,
                            ticks: {
                                stepSize: 1,
                                callback: function(value) {
                                    return value + ' / 5';
                                }
                            },
                            title: {
                                display: true,
                                text: 'مستوى الأداء',
                                font: {
                                    size: 14,
                                    weight: 'bold'
                                }
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'مجالات التقييم',
                                font: {
                                    size: 14,
                                    weight: 'bold'
                                }
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top',
                            labels: {
                                font: {
                                    size: 14,
                                    weight: 'bold'
                                }
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `التقييم: ${context.parsed.y} / 5`;
                                }
                            }
                        }
                    }
                }
            });
            
            // عرض القسم
            document.getElementById('result-title').innerHTML = "الرسم البياني لتقييم أداء المعلم";
            document.getElementById('result-content').innerHTML = `
                <p>يوضح الرسم البياني أدناه متوسط تقييم المعلم في كل مجال من مجالات التقييم. يمكن استخدام هذا الرسم لتحديد مجالات القوة والضعف في أداء المعلم.</p>
            `;
            document.getElementById('result-section').style.display = 'block';
            
            // التمرير إلى قسم النتائج
            document.getElementById('result-section').scrollIntoView({ behavior: 'smooth' });
        }
        
        // طباعة التقرير الكامل
        function printReport() {
            // التحقق من اكتمال التقييم
            let isComplete = true;
            
            evaluationData.forEach(domain => {
                domain.criteria.forEach((_, index) => {
                    if (!evaluationResults[domain.id] || !evaluationResults[domain.id][index]) {
                        isComplete = false;
                    }
                });
            });
            
            if (!isComplete) {
                alert("يرجى إكمال تقييم جميع المحاور قبل طباعة التقرير");
                return;
            }
            
            // تحضير البيانات للطباعة
            prepareForPrinting();
            
            // طباعة الصفحة
            setTimeout(() => {
                window.print();
            }, 500);
        }
        
        // تحضير البيانات للطباعة
        function prepareForPrinting() {
            // إضافة قيم التقييم إلى الجدول للطباعة
            const rows = document.querySelectorAll('.criterion-row');
            rows.forEach(row => {
                const select = row.querySelector('.rating-select');
                if (select && select.value !== "0") {
                    const value = select.value;
                    const valueSpan = document.createElement('span');
                    valueSpan.className = 'rating-value-print';
                    valueSpan.textContent = ` التقييم: ${value}/5`;
                    valueSpan.style.marginRight = '10px';
                    
                    // إضافة قيمة التقييم بجانب اسم المحور
                    const criterionName = row.querySelector('.criterion-name');
                    if (criterionName) {
                        criterionName.appendChild(valueSpan);
                    }
                }
            });
            
            // إضافة قيم بيانات المعلم والموجه للطباعة حتى لو فارغة
            const infoItems = document.querySelectorAll('.info-item');
            infoItems.forEach(item => {
                const input = item.querySelector('.info-input');
                const value = input ? input.value : '';
                const label = item.querySelector('.info-label').textContent.replace(':', '');
                
                // إضافة قيمة للطباعة
                const valueSpan = document.createElement('span');
                valueSpan.className = 'info-input-print';
                valueSpan.textContent = value || 'غير محدد';
                valueSpan.style.marginRight = '10px';
                valueSpan.style.fontSize = '14px';
                valueSpan.style.color = '#000000';
                
                item.appendChild(valueSpan);
                
                // إضافة سمة data-value للاستخدام في CSS
                item.setAttribute('data-value', value || 'غير محدد');
            });
            
            // تأكد من إنشاء التقرير أولاً
            generateReport();
        }
        
        // حفظ التقرير
        function saveReport() {
            // التحقق من اكتمال التقييم
            let isComplete = true;
            
            evaluationData.forEach(domain => {
                domain.criteria.forEach((_, index) => {
                    if (!evaluationResults[domain.id] || !evaluationResults[domain.id][index]) {
                        isComplete = false;
                    }
                });
            });
            
            if (!isComplete) {
                alert("يرجى إكمال تقييم جميع المحاور قبل حفظ التقرير");
                return;
            }
            
            // جمع بيانات المعلم
            const teacherData = {
                name: document.getElementById('teacher-name').value || "غير محدد",
                qualification: document.getElementById('teacher-qualification').value || "غير محدد",
                specialty: document.getElementById('teacher-specialty').value || "غير محدد",
                experience: document.getElementById('teacher-experience').value || "غير محدد",
                lessons: document.getElementById('teacher-lessons').value || "غير محدد",
                supervisor: document.getElementById('supervisor-name').value || "غير محدد",
                supervisorSpecialty: document.getElementById('supervisor-specialty').value || "غير محدد",
                visitDate: document.getElementById('visit-date').value || "غير محدد"
            };
            
            // تحويل تاريخ الزيارة إلى تنسيق عربي
            const visitDate = teacherData.visitDate !== "غير محدد" 
                ? new Date(teacherData.visitDate).toLocaleDateString('ar-EG')
                : "غير محدد";
            
            // في تطبيق حقيقي، هنا سيتم إنشاء ملف PDF أو حفظ البيانات
            // لكن في هذا النموذج، سنقوم بإنشاء نص التقرير وعرضه للنسخ
            
            let reportText = "استمارة الموجه الذكية (استمارة تقييم شامل لأداء المعلم)\n";
            reportText += "========================================================\n\n";
            reportText += "بيانات المعلم والموجه:\n";
            reportText += "---------------------\n";
            reportText += `اسم المعلم: ${teacherData.name}\n`;
            reportText += `المؤهل وتاريخه: ${teacherData.qualification}\n`;
            reportText += `تخصص المعلم: ${teacherData.specialty}\n`;
            reportText += `مدة الخبرة والحالة الوظيفية: ${teacherData.experience}\n`;
            reportText += `عدد الحصص: ${teacherData.lessons}\n`;
            reportText += `اسم الموجه الزائر: ${teacherData.supervisor}\n`;
            reportText += `تخصص الموجه: ${teacherData.supervisorSpecialty}\n`;
            reportText += `تاريخ الزيارة: ${visitDate}\n\n`;
            
            reportText += "نتائج التقييم:\n";
            reportText += "--------------\n";
            
            let totalScore = 0;
            let maxScore = 0;
            let domainDetails = [];
            
            evaluationData.forEach(domain => {
                reportText += `\n${domain.title}:\n`;
                let domainTotal = 0;
                
                domain.criteria.forEach((criterion, index) => {
                    maxScore += 5;
                    const score = evaluationResults[domain.id][index];
                    domainTotal += score;
                    totalScore += score;
                    
                    reportText += `  • ${criterion.name}: ${score}/5\n`;
                });
                
                const domainAvg = (domainTotal / domain.criteria.length).toFixed(2);
                const domainPercentage = Math.round((domainTotal / (domain.criteria.length * 5)) * 100);
                domainDetails.push({
                    name: domain.title.split(':')[1],
                    avg: domainAvg,
                    percentage: domainPercentage
                });
                
                reportText += `  • متوسط المجال: ${domainAvg}/5 (${domainPercentage}%)\n`;
            });
            
            const overallPercentage = Math.round((totalScore / maxScore) * 100);
            let overallRating = "";
            
            if (overallPercentage >= 90) overallRating = "متميز";
            else if (overallPercentage >= 80) overallRating = "جيد جداً";
            else if (overallPercentage >= 70) overallRating = "جيد";
            else if (overallPercentage >= 60) overallRating = "مقبول";
            else overallRating = "بحاجة إلى تحسين";
            
            reportText += `\nالنتيجة الإجمالية: ${totalScore}/${maxScore} (${overallPercentage}%) - ${overallRating}\n\n`;
            
            reportText += "المؤشرات الزمنية:\n";
            reportText += "-----------------\n";
            reportText += `• زمن تحدث المعلم: ${formatTime(teacherTimer.seconds)}\n`;
            reportText += `• زمن تحدث الطلاب: ${formatTime(studentTimer.seconds)}\n`;
            reportText += `• مؤشر التفاعل: ${document.getElementById('interaction-value').textContent}\n\n`;
            
            reportText += "الملاحظات الإضافية:\n";
            reportText += "-------------------\n";
            reportText += `${document.getElementById('additional-notes').value || "لا توجد ملاحظات إضافية"}\n\n`;
            
            reportText += "نقاط القوة والتوصيات:\n";
            reportText += "---------------------\n";
            
            // إضافة نقاط القوة والتوصيات
            let bestDomain = domainDetails.reduce((prev, current) => (prev.percentage > current.percentage) ? prev : current);
            let worstDomain = domainDetails.reduce((prev, current) => (prev.percentage < current.percentage) ? prev : current);
            
            reportText += `• نقاط القوة: تميز في ${bestDomain.name} بنسبة ${bestDomain.percentage}%\n`;
            reportText += `• مجالات التحسين: يحتاج تطوير في ${worstDomain.name} بنسبة ${worstDomain.percentage}%\n`;
            reportText += `• التوصيات: ${getRecommendation(1, domainDetails.indexOf(worstDomain) + 1)}\n`;
            reportText += `• التوصيات: ${getRecommendation(2, domainDetails.indexOf(worstDomain) + 1)}\n\n`;
            
            reportText += "التوقيع:\n";
            reportText += "-------\n";
            reportText += `الموجه التربوي: ${teacherData.supervisor}\n`;
            reportText += `التاريخ: ${new Date().toLocaleDateString('ar-EG')}\n\n`;
            reportText += "إعداد: نجاة شمسان\n";
            reportText += "2026 الاستمارة الذكية لتقييم أداء المعلم\n";
            
            // إنشاء نافذة لعرض التقرير للنسخ
            const reportWindow = window.open("", "التقرير", "width=800,height=600");
            reportWindow.document.write(`
                <!DOCTYPE html>
                <html dir="rtl">
                <head>
                    <meta charset="UTF-8">
                    <title>تقرير التقييم</title>
                    <style>
                        body { font-family: Arial, sans-serif; padding: 20px; line-height: 1.6; background-color: #f5e9dc; color: #000000; font-size: 14px !important; }
                        pre { white-space: pre-wrap; font-family: inherit; background-color: #ffffff; padding: 20px; border-radius: 10px; border: 1px solid #d7c4b8; font-size: 14px !important; }
                        button { padding: 10px 20px; margin: 10px; background: #8B4513; color: #ffffff; border: none; cursor: pointer; border-radius: 5px; font-weight: bold; font-size: 14px !important; }
                        button:hover { background: #5D4037; }
                        .print-title { color: #000000; text-align: center; margin-bottom: 20px; }
                        h2 { color: #000000; font-weight: bold; font-size: 18px !important; }
                    </style>
                </head>
                <body>
                    <div class="print-title">
                        <h2>تقرير التقييم الكامل - جاهز للحفظ والمشاركة</h2>
                        <p>يمكنك نسخ النص أدناه ولصقه في أي تطبيق (Word، Google Docs، إلخ) أو حفظه كمستند نصي.</p>
                    </div>
                    <pre>${reportText}</pre>
                    <div style="text-align: center;">
                        <button onclick="window.print()"><i class="fas fa-print"></i> طباعة التقرير</button>
                        <button onclick="navigator.clipboard.writeText(document.querySelector('pre').innerText).then(() => alert('تم نسخ التقرير إلى الحافظة'))"><i class="fas fa-copy"></i> نسخ التقرير</button>
                        <button onclick="window.close()"><i class="fas fa-times"></i> إغلاق</button>
                    </div>
                    <script>
                        // إضافة أيقونات Font Awesome
                        var faScript = document.createElement('script');
                        faScript.src = 'https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js';
                        document.head.appendChild(faScript);
                    <\/script>
                </body>
                </html>
            `);
            
            alert("تم فتح نافذة جديدة تحتوي على التقرير الكامل.\nيمكنك:\n1. نسخ النص ولصقه في أي تطبيق\n2. طباعة التقرير مباشرة\n3. حفظ الصفحة كملف PDF (من قائمة الطباعة)");
        }
        
        // دوال مساعدة
        function formatTime(seconds) {
            const hours = Math.floor(seconds / 3600);
            const minutes = Math.floor((seconds % 3600) / 60);
            const secs = seconds % 60;
            
            return `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }
        
        function getStrongestDomain(domainAverages) {
            let maxAvg = 0;
            let strongestDomain = "";
            
            for (const [id, avg] of Object.entries(domainAverages)) {
                if (parseFloat(avg) > maxAvg) {
                    maxAvg = parseFloat(avg);
                    strongestDomain = evaluationData.find(d => d.id == id).title.split(':')[1];
                }
            }
            
            return strongestDomain;
        }
        
        function getSecondStrongestDomain(domainAverages) {
            let domains = [];
            
            for (const [id, avg] of Object.entries(domainAverages)) {
                domains.push({
                    id: id,
                    avg: parseFloat(avg),
                    name: evaluationData.find(d => d.id == id).title.split(':')[1]
                });
            }
            
            domains.sort((a, b) => b.avg - a.avg);
            
            return domains.length > 1 ? domains[1].name : domains[0].name;
        }
        
        function getWeakestDomain(domainAverages) {
            let minAvg = 5;
            let weakestDomain = "";
            
            for (const [id, avg] of Object.entries(domainAverages)) {
                if (parseFloat(avg) < minAvg) {
                    minAvg = parseFloat(avg);
                    weakestDomain = evaluationData.find(d => d.id == id).title.split(':')[1];
                }
            }
            
            return weakestDomain;
        }
        
        function getSecondWeakestDomain(domainAverages) {
            let domains = [];
            
            for (const [id, avg] of Object.entries(domainAverages)) {
                domains.push({
                    id: id,
                    avg: parseFloat(avg),
                    name: evaluationData.find(d => d.id == id).title.split(':')[1]
                });
            }
            
            domains.sort((a, b) => a.avg - b.avg);
            
            return domains.length > 1 ? domains[1].name : domains[0].name;
        }
        
        function getImprovementSuggestions(domainId) {
            const suggestions = {
                1: "تخطيط أكثر تفصيلاً ومراعاة الفروق الفردية",
                2: "تنويع استراتيجيات التدريس وإدارة الوقت بكفاءة",
                3: "تحفيز التفكير العليا وتوزيع المشاركة بشكل عادل",
                4: "تحسين البيئة الصفية وخلق مناخ نفسي إيجابي",
                5: "تنويع أدوات التقويم والاستجابة الفورية لنتائجه",
                6: "الاهتمام بالمظهر العام ومواصلة التطوير الذاتي"
            };
            
            return suggestions[domainId] || "تطوير المهارات التعليمية بشكل عام";
        }
        
        function getRecommendation(type, domainId) {
            const recommendations = {
                1: "مشاهدة دروس نموذجية لمعلمين متميزين في نفس التخصص",
                2: "التدرب على استخدام استراتيجيات تدريس جديدة تركز على التعلم النشط",
                3: "تصميم أنشطة تقويم تكويني متنوعة وربطها بأهداف التعلم",
                4: "الاستفادة من التغذية الراجعة من الزملاء والموجهين لتطوير الممارسات التعليمية",
                5: "القراءة في أساليب إدارة الصف الفعالة وتطبيقاتها العملية",
                6: "المشاركة في ورش العمل والدورات التدريبية التي تقدمها إدارة التدريب"
            };
            
            return recommendations[type] || recommendations[1];
        }
        
        function getTrainingTopic(domainId) {
            const topics = {
                1: "التخطيط للدرس الفعال ومراعاة الفروق الفردية",
                2: "استراتيجيات التدريس الحديثة وإدارة الصف",
                3: "تقنيات التقويم التكويني والختامي",
                4: "تصميم أنشطة تعلم تنمي مهارات التفكير العليا",
                5: "تطوير الذات والمهارات القيادية للمعلم",
                6: "أساليب زيادة مشاركة الطلاب وتحفيزهم",
                7: "التطوير المهني المستمر وأخلاقيات المهنة"
            };
            
            return topics[domainId] || "التطوير المهني للمعلم";
        }
        
        function getResources(domainId) {
            const resources = {
                1: "نماذج خطط دروس ناجحة",
                2: "أدلة استراتيجيات التدريس النشط",
                3: "بنك أسئلة وأدوات تقويم متنوعة",
                4: "نماذج لأنشطة تعلم تفاعلية",
                5: "مواد تدريبية عن أخلاقيات المهنة والتطوير الذاتي",
                6: "أدوات تقييم مشاركة الطلاب",
                7: "موارد للتعلم المستمر والتطوير المهني"
            };
            
            return resources[domainId] || "موارد تعليمية وتدريبية مناسبة";
        }
    </script>
</body>
  </html>
